<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="author" content="Jan-Hendrik Ewers" />
    <link
      rel="shortcut icon"
      type="image/x-icon"
      href="/static/img/favicon.ico"
    />
    <link rel="alternate" type="application/atom+xml" href="/atom.xml" />

    
    <meta name="description" content="Pydantic v2 claims to be 5-50x faster than v1. Is this accurate? Let's put this to the test!" />
     
    <title>Pydantic 1 vs 2: A Speed Comparison</title>
    

    <!-- Bootstrap -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3"
      crossorigin="anonymous"
    />

    <!-- Custom styles for this template -->
    <link rel="stylesheet" type="text/css" href="/static/css/main.css" />
    <link rel="stylesheet" type="text/css" href="/static/css/syntax.css" />
    <link
      rel="preload"
      as="style"
      onload="this.rel = 'stylesheet'"
      href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:200,400,200bold,400old&display=swap"
    />
    <noscript>
      <link
        rel="stylesheet"
        type="text/css"
        href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:200,400,200bold,400old&display=swap"
      />
    </noscript>

    <link
      rel="stylesheet"
      type="text/css"
      href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css"
    />

     <script
  defer
  data-domain="janhendrikewers.uk"
  data-api="https://divine-wood-7bde.dev-jh-ewers4177.workers.dev/bd7483245a4d6b07"
  src="https://divine-wood-7bde.dev-jh-ewers4177.workers.dev/18dcc14a8dd9f785.js"
></script>
 

    <!-- mathjax support -->
    
    <script>
      window.MathJax = {
        tex: {
          inlineMath: [
            ["$", "$"],
            ["\\(", "\\)"],
          ],
        },
        loader: { load: ["ui/lazy"] },
      };
    </script>
    <script
      type="text/javascript"
      id="MathJax-script"
      async
      src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js"
    ></script>
    

    <!-- academicons -->
    <!-- https://jpswalsh.github.io/academicons/ -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/gh/jpswalsh/academicons@1/css/academicons.min.css"
    />
  </head>

  <!-- Main Body-->
  <body>
    <div>
      <!-- Navbar header -->
      <div class="container">
  <header
    class="d-flex flex-wrap align-items-center justify-content-center justify-content-md-between py-3 mb-4 border-bottom"
  >
    <a
      href="/"
      class="d-flex align-items-center col-md-3 mb-2 mb-md-0 text-dark text-decoration-none plausible-event-name=Header+Click"
    >
      <img
        src="/static/img/logo.svg"
        width="100px"
        height="100px"
        alt="Jan-Hendrik Ewers Logo"
        class="img-fluid"
      />
    </a>

    <ul class="nav col-12 col-md-auto mb-2 justify-content-center mb-md-0">
      <li>
        <a
          href="/blog"
          class="nav-link px-2 link-dark plausible-event-name=Header+Click"
          >BLOG</a
        >
      </li>
      <li>
        <a
          href="/publications"
          class="nav-link px-2 link-dark plausible-event-name=Header+Click"
          >PUBLICATIONS</a
        >
      </li>
      <li>
        <a
          href="/projects"
          class="nav-link px-2 link-dark plausible-event-name=Header+Click"
          >PROJECTS</a
        >
      </li>
      <li>
        <a
          href="/bookshelf"
          class="nav-link px-2 link-dark plausible-event-name=Header+Click"
          >MY BOOKSHELF</a
        >
      </li>
      <li>
        <a
          href="/static/pdf/cv.pdf"
          class="nav-link px-2 link-dark plausible-event-name=Header+Click"
          >RESUME</a
        >
      </li>
    </ul>
  </header>
</div>
 <div class="container">
  <div class="blog-post">
    <h1 class="fs-3 fw-bold">Pydantic 1 vs 2: A Speed Comparison</h1>
  </div>
  <div class="blog-title">
    <p class="fs-5">
       August 18, 2023 
       &nbsp;&nbsp; 
      <span class="badge rounded-pill">python</span>
      
      <span class="badge rounded-pill">pydantic</span>
      
      <span class="badge rounded-pill">performance</span>
       
    </p>
    <style>
  #share-buttons {
    display: inline-block;
    vertical-align: middle;
  }
  #share-buttons:after {
    content: "";
    display: block;
    clear: both;
  }
  #share-buttons > div {
    position: relative;
    text-align: left;
    height: 36px;
    width: 32px;
    float: left;
    text-align: center;
  }
  #share-buttons > div > svg {
    height: 16px;
    fill: #666666;
    margin-top: 10px;
  }
  #share-buttons > div:hover {
    cursor: pointer;
  }
  #share-buttons > div.facebook:hover > svg {
    fill: #3b5998;
  }
  #share-buttons > div.twitter:hover > svg {
    fill: #55acee;
  }
  #share-buttons > div.linkedin:hover > svg {
    fill: #0077b5;
  }
  #share-buttons > div.pinterest:hover > svg {
    fill: #cb2027;
  }
  #share-buttons > div.gplus:hover > svg {
    fill: #dd4b39;
  }
  #share-buttons > div.mail:hover > svg {
    fill: #7d7d7d;
  }
  #share-buttons > div.instagram:hover > svg {
    fill: #c73b92;
  }
  #share-buttons > div.facebook > svg {
    height: 18px;
    margin-top: 9px;
  }
  #share-buttons > div.twitter > svg {
    height: 20px;
    margin-top: 8px;
  }
  #share-buttons > div.linkedin > svg {
    height: 19px;
    margin-top: 7px;
  }
  #share-buttons > div.pinterest > svg {
    height: 20px;
    margin-top: 9px;
  }
  #share-buttons > div.gplus > svg {
    height: 17px;
    margin-top: 9px;
    position: relative;
    left: 1px;
  }
  #share-buttons > div.mail > svg {
    height: 14px;
    margin-top: 11px;
  }
</style>

<div id="share-buttons">
  <div
    class="facebook"
    title="Share this on Facebook"
    onclick="window.open('https://www.facebook.com/sharer/sharer.php?u=https://janhendrikewers.uk/pydantic-1-vs-2-a-benchmark-test.html');"
  >
    <svg viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg">
      <path
        d="M1343 12v264h-157q-86 0-116 36t-30 108v189h293l-39 296h-254v759h-306v-759h-255v-296h255v-218q0-186 104-288.5t277-102.5q147 0 228 12z"
      />
    </svg>
  </div>
  <div
    class="twitter"
    title="Share this on Twitter"
    onclick="window.open('https://twitter.com/intent/tweet?url=https://janhendrikewers.uk/pydantic-1-vs-2-a-benchmark-test.html&text=');"
  >
    <svg viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg">
      <path
        d="M1684 408q-67 98-162 167 1 14 1 42 0 130-38 259.5t-115.5 248.5-184.5 210.5-258 146-323 54.5q-271 0-496-145 35 4 78 4 225 0 401-138-105-2-188-64.5t-114-159.5q33 5 61 5 43 0 85-11-112-23-185.5-111.5t-73.5-205.5v-4q68 38 146 41-66-44-105-115t-39-154q0-88 44-163 121 149 294.5 238.5t371.5 99.5q-8-38-8-74 0-134 94.5-228.5t228.5-94.5q140 0 236 102 109-21 205-78-37 115-142 178 93-10 186-50z"
      />
    </svg>
  </div>
  <div
    class="linkedin"
    title="Share this on Linkedin"
    onclick="window.open('https://www.linkedin.com/shareArticle?mini=true&url=https://janhendrikewers.uk/pydantic-1-vs-2-a-benchmark-test.html&title=&summary=&source=');"
  >
    <svg viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg">
      <path
        d="M477 625v991h-330v-991h330zm21-306q1 73-50.5 122t-135.5 49h-2q-82 0-132-49t-50-122q0-74 51.5-122.5t134.5-48.5 133 48.5 51 122.5zm1166 729v568h-329v-530q0-105-40.5-164.5t-126.5-59.5q-63 0-105.5 34.5t-63.5 85.5q-11 30-11 81v553h-329q2-399 2-647t-1-296l-1-48h329v144h-2q20-32 41-56t56.5-52 87-43.5 114.5-15.5q171 0 275 113.5t104 332.5z"
      />
    </svg>
  </div>
  <div
    class="mail"
    title="Share this through Email"
    onclick="window.open('mailto:?&body=https://janhendrikewers.uk/pydantic-1-vs-2-a-benchmark-test.html');"
  >
    <svg viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg">
      <path
        d="M1792 710v794q0 66-47 113t-113 47h-1472q-66 0-113-47t-47-113v-794q44 49 101 87 362 246 497 345 57 42 92.5 65.5t94.5 48 110 24.5h2q51 0 110-24.5t94.5-48 92.5-65.5q170-123 498-345 57-39 100-87zm0-294q0 79-49 151t-122 123q-376 261-468 325-10 7-42.5 30.5t-54 38-52 32.5-57.5 27-50 9h-2q-23 0-50-9t-57.5-27-52-32.5-54-38-42.5-30.5q-91-64-262-182.5t-205-142.5q-62-42-117-115.5t-55-136.5q0-78 41.5-130t118.5-52h1472q65 0 112.5 47t47.5 113z"
      />
    </svg>
  </div>
</div>

  </div>

  <hr />

  <div class="panel panel-default">
    <div class="panel-body">
      <div class="blogpost">
        <p>Back in 2022 I did <a href="/pydantic_vs_protobuf_vs_namedtuple_vs_dataclasses.html">a comparison of some of the most well known python data class libraries</a> in various categories. In this blog post I came to the conclusion that pydantic was only apt for less performant applications. However, with the release of <a href="https://docs.pydantic.dev/2.0/blog/pydantic-v2-final/">Pydantic v2</a> in late June of 2023 touting 5-50x speed improvements compared to v1 due to a rewrite of the <a href="https://github.com/pydantic/pydantic-core">core logic in Rust</a>.</p>

<p>So in the face of these new claims, lets put it to the test.</p>

<h2 id="experimental-setup">Experimental Setup</h2>

<p>My workload hasn’t changed much since the last post, so I will still have a simulation based approach.</p>

<p>I made two very simple data types. <code class="language-plaintext highlighter-rouge">Coord</code> relies on purely python native types, and <code class="language-plaintext highlighter-rouge">Coords</code> holds a list of the <code class="language-plaintext highlighter-rouge">Coord</code> type.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Coord</span><span class="p">(</span><span class="n">pydantic</span><span class="p">.</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">x</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">y</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">z</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">heading</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">tag</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">idx</span><span class="p">:</span> <span class="nb">int</span>

<span class="k">class</span> <span class="nc">Coords</span><span class="p">(</span><span class="n">pydantic</span><span class="p">.</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">coords</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Coord</span><span class="p">]</span>
</code></pre></div></div>

<p>We create the $N$ length data using the same seed to ensure it’s an apples for apples comparison across the versions.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">create_data</span><span class="p">(</span><span class="n">N</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span><span class="n">seed</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">rng</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="nf">default_rng</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>

    <span class="n">positions</span> <span class="o">=</span> <span class="n">rng</span><span class="p">.</span><span class="nf">random</span><span class="p">((</span><span class="n">N</span><span class="p">,</span> <span class="mi">3</span><span class="p">)).</span><span class="nf">astype</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">float32</span><span class="p">)</span>
    <span class="n">headings</span> <span class="o">=</span> <span class="n">rng</span><span class="p">.</span><span class="nf">random</span><span class="p">(</span><span class="n">N</span><span class="p">).</span><span class="nf">astype</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">float32</span><span class="p">)</span>
    <span class="n">idxs</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">N</span><span class="p">).</span><span class="nf">astype</span><span class="p">(</span><span class="n">snp</span><span class="p">.</span><span class="n">int32</span><span class="p">)</span>
    <span class="n">tags</span> <span class="o">=</span> <span class="nf">list</span><span class="p">(</span>
        <span class="nf">map</span><span class="p">(</span>
            <span class="sh">""</span><span class="p">.</span><span class="n">join</span><span class="p">,</span>
            <span class="n">np</span><span class="p">.</span><span class="nf">array</span><span class="p">(</span><span class="nf">list</span><span class="p">(</span><span class="n">string</span><span class="p">.</span><span class="n">ascii_letters</span><span class="p">))[</span>
                <span class="n">rng</span><span class="p">.</span><span class="nf">choice</span><span class="p">(</span><span class="nf">len</span><span class="p">(</span><span class="n">string</span><span class="p">.</span><span class="n">ascii_letters</span><span class="p">),</span> <span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="mi">100</span><span class="p">))</span>
            <span class="p">],</span>
        <span class="p">)</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">positions</span><span class="p">,</span> <span class="n">headings</span><span class="p">,</span> <span class="n">idxs</span><span class="p">,</span> <span class="n">tags</span>
</code></pre></div></div>

<p>This is then used to instantiate $N$ classes of <code class="language-plaintext highlighter-rouge">Coord</code> which is then used to instantiate one class of <code class="language-plaintext highlighter-rouge">Coords</code> with</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="n">positions</span><span class="p">,</span> <span class="n">headings</span><span class="p">,</span> <span class="n">idxs</span><span class="p">,</span> <span class="n">tags</span><span class="p">):</span>
    <span class="n">coords</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">position</span><span class="p">,</span> <span class="n">heading</span><span class="p">,</span> <span class="n">idx</span><span class="p">,</span> <span class="n">tag</span> <span class="ow">in</span> <span class="nf">zip</span><span class="p">(</span><span class="n">positions</span><span class="p">,</span> <span class="n">headings</span><span class="p">,</span> <span class="n">idxs</span><span class="p">,</span> <span class="n">tags</span><span class="p">):</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="n">position</span>
        <span class="n">coords</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="nc">Coord</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="n">z</span><span class="p">,</span> <span class="n">heading</span><span class="o">=</span><span class="n">heading</span><span class="p">,</span> <span class="n">idx</span><span class="o">=</span><span class="n">idx</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="n">tag</span><span class="p">))</span>
    <span class="k">return</span> <span class="nc">Coords</span><span class="p">(</span><span class="n">coords</span><span class="o">=</span><span class="n">coords</span><span class="p">)</span>
</code></pre></div></div>

<p>Every loop of this function is timed using <a href="https://docs.python.org/3/library/time.html#time.perf_counter_ns"><code class="language-plaintext highlighter-rouge">time.perf_counter_ns</code></a>.</p>

<h2 id="performance">Performance</h2>

<p>We start by comparing the performance from $N=1$ to $N=100$ (with $100$ repeats at every $N$) as seen below in the figure.</p>

<p class="centre"><img src="/static/img/2023-08-18-pydantic-1-vs-2-a-benchmark-test/correct_dtypes.png" alt="Speed comparison of instantiating the Pydantic data classes" class="img-responsive" />
<em>Time taken to instantiate the data classes by Pydantic version</em></p>

<p>Evidently the claims are accurate! <code class="language-plaintext highlighter-rouge">v2.1.1</code> is substantially faster than <code class="language-plaintext highlighter-rouge">v1.10.8</code> over all data points with both seemingly having an $O(n)$ relationship.</p>

<p>To give Pydantic something more to chew on, we’ll feed it data types that it’ll have to convert. We’ll simply pre-emptively convert <code class="language-plaintext highlighter-rouge">float</code> to <code class="language-plaintext highlighter-rouge">int</code> and vise-versa. Not the hardest task in the world but interesting nonetheless as this occurs often in my workflows.</p>

<p class="centre"><img src="/static/img/2023-08-18-pydantic-1-vs-2-a-benchmark-test/incorrect_dtypes.png" alt="Speed comparison of instantiating the Pydantic data classes with incorrect data types" class="img-responsive" />
<em>Time taken to instantiate the data classes by Pydantic version with incorrect (but castable) data types</em></p>

<p>Inpsecting the above graph, this has slightly slowed down both versions but not by much.</p>

<h2 id="final-thoughts">Final Thoughts</h2>

<p>Given that the Pydantic team have taken the time and effort to rewrite the core of the library in Rust, the results are no surprise. With the massive popularity of libraries like <a href="https://fastapi.tiangolo.com/">FastAPI</a> and <a href="https://www.dynaconf.com/release_notes/#coming-in-31x">Dynaconf</a> using Pydantic for core functionality, this performance improvement will help the community massively in the form of saving on compute time. However, for cases where type checking isn’t essential, <code class="language-plaintext highlighter-rouge">namedtuples</code> and <code class="language-plaintext highlighter-rouge">dataclasses</code> are probably still the way to go for raw speed. Nonetheless, I will now consider using Pydantic in more scenarios because of these speed gains and because it’s a bloody brilliant library!</p>

<h2 id="future-work">Future Work?</h2>

<p>I might redo the analysis undertaken in the afformentioned <a href="/pydantic_vs_protobuf_vs_namedtuple_vs_dataclasses.html">previous post</a>, with some more suggestions made by my readers:</p>

<ul>
  <li><a href="https://docs.pydantic.dev/latest/usage/dataclasses/">pydantic-dataclasses</a></li>
  <li><a href="https://atom.readthedocs.io/en/latest/">atom</a></li>
  <li>Custom <a href="https://github.com/pybind/pybind11">pybind11</a> objects</li>
  <li>… ?</li>
</ul>

<p>If this is something you’d be interested in, please let me know in the <a href="#comments">comments</a>!</p>

        <hr />
        <div class="related-posts">
          <h5>Related Posts</h5>
          
          <div class="row row-cols-sm-1 row-cols-md-2 row-cols-lg-2">
            <div class="col-sm-4 col-md-4 col-lg-4">
              <h6 class="text-sm-start text-md-end text-lg-end">
                March 22, 2022
              </h6>
            </div>
            <div class="col-sm-8 col-md-8 col-lg-8">
              <h6 class="text-start">
                <a
                  class="text-decoration-none plausible-event-name=Related+Post+Click"
                  href="/pydantic_vs_protobuf_vs_namedtuple_vs_dataclasses.html"
                >Pydantic vs Protobuf vs Namedtuples vs Dataclasses. Which Python Data Class Is Best?</a>
              </h6>
            </div>
          </div>
          
          <div class="row row-cols-sm-1 row-cols-md-2 row-cols-lg-2">
            <div class="col-sm-4 col-md-4 col-lg-4">
              <h6 class="text-sm-start text-md-end text-lg-end">
                October  3, 2021
              </h6>
            </div>
            <div class="col-sm-8 col-md-8 col-lg-8">
              <h6 class="text-start">
                <a
                  class="text-decoration-none plausible-event-name=Related+Post+Click"
                  href="/scheduled-off-site-backups-for-paperless-ng-using-rclone.html"
                >Scheduling Backups To OneDrive For Paperless-ng Using RClone</a>
              </h6>
            </div>
          </div>
          
          <div class="row row-cols-sm-1 row-cols-md-2 row-cols-lg-2">
            <div class="col-sm-4 col-md-4 col-lg-4">
              <h6 class="text-sm-start text-md-end text-lg-end">
                March  8, 2022
              </h6>
            </div>
            <div class="col-sm-8 col-md-8 col-lg-8">
              <h6 class="text-start">
                <a
                  class="text-decoration-none plausible-event-name=Related+Post+Click"
                  href="/serialization_of_pydantic_data_models_with_json_whilst_preserving_type_data.html"
                >Serialization Of Pydantic Data Models With JSON Whilst Preserving Type Data</a>
              </h6>
            </div>
          </div>
          
        </div>
      </div>
    </div>
  </div>
  <div id="comments"></div>
  <script
  src="https://utteranc.es/client.js"
  repo="iwishiwasaneagle/janhendrikewers.uk"
  issue-term="pathname"
  theme="github-light"
  crossorigin="anonymous"
  async
></script>

</div>

    </div>

    <!-- Footer -->
    <footer class="mt-auto py-3">
  <div class="container">
    <span class="text-muted"
      >© All rights reserved. Contribute at
      <a href="https://github.com/iwishiwasaneagle/janhendrikewers.uk">
        GitHub</a
      >. Powered by <a href="http://jekyllrb.com/">Jekyll</a> with ♥</span
    >
  </div>
</footer>

  </body>
</html>
