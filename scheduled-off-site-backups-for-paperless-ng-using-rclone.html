<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="author" content="Jan-Hendrik Ewers" />
    <link
      rel="shortcut icon"
      type="image/x-icon"
      href="static/img/favicon.ico"
    />
    <link
      rel="alternate"
      type="application/atom+xml"
      href="https://janhendrikewers.uk/atom.xml"
    />

    
    <meta name="description" content="Personal blog and resume for Jan-Hendrik Ewers." />
     
    <title>Scheduling Backups To OneDrive For Paperless-ng Using RClone</title>
    

    <!-- Bootstrap -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3"
      crossorigin="anonymous"
    />

    <!-- Custom styles for this template -->
    <link
      rel="stylesheet"
      type="text/css"
      href="static/css/main.css"
    />
    <link
      rel="preload"
      as="style"
      onload="this.rel = 'stylesheet'"
      href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:200,400,200bold,400old&display=swap"
    />
    <noscript>
      <link
        rel="stylesheet"
        type="text/css"
        href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:200,400,200bold,400old&display=swap"
      />
    </noscript>

    <link
      rel="stylesheet"
      type="text/css"
      href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css"
    />

     <script
  defer
  data-domain="janhendrikewers.uk"
  data-api="https://divine-wood-7bde.dev-jh-ewers4177.workers.dev/bd7483245a4d6b07"
  src="https://divine-wood-7bde.dev-jh-ewers4177.workers.dev/18dcc14a8dd9f785.js"
></script>
 

    <!-- mathjax support -->
    
  </head>

  <!-- Main Body-->
  <body>
    <div>
      <!-- Navbar header -->
      <div class="container">
  <header
    class="d-flex flex-wrap align-items-center justify-content-center justify-content-md-between py-3 mb-4 border-bottom"
  >
    <a
      href="/"
      class="d-flex align-items-center col-md-3 mb-2 mb-md-0 text-dark text-decoration-none plausible-event-name=Header+Click"
    >
      <img
        src="/static/img/logo.svg"
        width="100px"
        height="100px"
        alt="Jan-Hendrik Ewers Logo"
        class="img-fluid"
      />
    </a>

    <ul class="nav col-12 col-md-auto mb-2 justify-content-center mb-md-0">
      <li>
        <a
          href="/blog"
          class="nav-link px-2 link-dark plausible-event-name=Header+Click"
          >BLOG</a
        >
      </li>
      <li>
        <a
          href="/projects"
          class="nav-link px-2 link-dark plausible-event-name=Header+Click"
          >PROJECTS</a
        >
      </li>
      <li>
        <a
          href="/bookshelf"
          class="nav-link px-2 link-dark plausible-event-name=Header+Click"
          >MY BOOKSHELF</a
        >
      </li>
      <li>
        <a
          href="/static/pdf/cv.pdf"
          class="nav-link px-2 link-dark plausible-event-name=Header+Click"
          >RESUME</a
        >
      </li>
    </ul>
  </header>
</div>
 <div class="container">
  <div class="blog-post">
    <h1 class="fs-3 fw-bold">Scheduling Backups To OneDrive For Paperless-ng Using RClone</h1>
  </div>
  <div class="blog-title">
    <p class="fs-5">
      October  3, 2021 &nbsp;&nbsp; 

      <span class="badge rounded-pill">paperless-ng</span>

      

      <span class="badge rounded-pill">raspberry-pi</span>

      

      <span class="badge rounded-pill">backups</span>

      
    </p>
    <style>
  #share-buttons {
    display: inline-block;
    vertical-align: middle;
  }
  #share-buttons:after {
    content: "";
    display: block;
    clear: both;
  }
  #share-buttons > div {
    position: relative;
    text-align: left;
    height: 36px;
    width: 32px;
    float: left;
    text-align: center;
  }
  #share-buttons > div > svg {
    height: 16px;
    fill: #666666;
    margin-top: 10px;
  }
  #share-buttons > div:hover {
    cursor: pointer;
  }
  #share-buttons > div.facebook:hover > svg {
    fill: #3b5998;
  }
  #share-buttons > div.twitter:hover > svg {
    fill: #55acee;
  }
  #share-buttons > div.linkedin:hover > svg {
    fill: #0077b5;
  }
  #share-buttons > div.pinterest:hover > svg {
    fill: #cb2027;
  }
  #share-buttons > div.gplus:hover > svg {
    fill: #dd4b39;
  }
  #share-buttons > div.mail:hover > svg {
    fill: #7d7d7d;
  }
  #share-buttons > div.instagram:hover > svg {
    fill: #c73b92;
  }
  #share-buttons > div.facebook > svg {
    height: 18px;
    margin-top: 9px;
  }
  #share-buttons > div.twitter > svg {
    height: 20px;
    margin-top: 8px;
  }
  #share-buttons > div.linkedin > svg {
    height: 19px;
    margin-top: 7px;
  }
  #share-buttons > div.pinterest > svg {
    height: 20px;
    margin-top: 9px;
  }
  #share-buttons > div.gplus > svg {
    height: 17px;
    margin-top: 9px;
    position: relative;
    left: 1px;
  }
  #share-buttons > div.mail > svg {
    height: 14px;
    margin-top: 11px;
  }
</style>

<div id="share-buttons">
  <div
    class="facebook"
    title="Share this on Facebook"
    onclick="window.open('https://www.facebook.com/sharer/sharer.php?u=https://janhendrikewers.uk/scheduled-off-site-backups-for-paperless-ng-using-rclone.html');"
  >
    <svg viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg">
      <path
        d="M1343 12v264h-157q-86 0-116 36t-30 108v189h293l-39 296h-254v759h-306v-759h-255v-296h255v-218q0-186 104-288.5t277-102.5q147 0 228 12z"
      />
    </svg>
  </div>
  <div
    class="twitter"
    title="Share this on Twitter"
    onclick="window.open('https://twitter.com/intent/tweet?url=https://janhendrikewers.uk/scheduled-off-site-backups-for-paperless-ng-using-rclone.html&text=');"
  >
    <svg viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg">
      <path
        d="M1684 408q-67 98-162 167 1 14 1 42 0 130-38 259.5t-115.5 248.5-184.5 210.5-258 146-323 54.5q-271 0-496-145 35 4 78 4 225 0 401-138-105-2-188-64.5t-114-159.5q33 5 61 5 43 0 85-11-112-23-185.5-111.5t-73.5-205.5v-4q68 38 146 41-66-44-105-115t-39-154q0-88 44-163 121 149 294.5 238.5t371.5 99.5q-8-38-8-74 0-134 94.5-228.5t228.5-94.5q140 0 236 102 109-21 205-78-37 115-142 178 93-10 186-50z"
      />
    </svg>
  </div>
  <div
    class="linkedin"
    title="Share this on Linkedin"
    onclick="window.open('https://www.linkedin.com/shareArticle?mini=true&url=https://janhendrikewers.uk/scheduled-off-site-backups-for-paperless-ng-using-rclone.html&title=&summary=&source=');"
  >
    <svg viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg">
      <path
        d="M477 625v991h-330v-991h330zm21-306q1 73-50.5 122t-135.5 49h-2q-82 0-132-49t-50-122q0-74 51.5-122.5t134.5-48.5 133 48.5 51 122.5zm1166 729v568h-329v-530q0-105-40.5-164.5t-126.5-59.5q-63 0-105.5 34.5t-63.5 85.5q-11 30-11 81v553h-329q2-399 2-647t-1-296l-1-48h329v144h-2q20-32 41-56t56.5-52 87-43.5 114.5-15.5q171 0 275 113.5t104 332.5z"
      />
    </svg>
  </div>
  <div
    class="mail"
    title="Share this through Email"
    onclick="window.open('mailto:?&body=https://janhendrikewers.uk/scheduled-off-site-backups-for-paperless-ng-using-rclone.html');"
  >
    <svg viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg">
      <path
        d="M1792 710v794q0 66-47 113t-113 47h-1472q-66 0-113-47t-47-113v-794q44 49 101 87 362 246 497 345 57 42 92.5 65.5t94.5 48 110 24.5h2q51 0 110-24.5t94.5-48 92.5-65.5q170-123 498-345 57-39 100-87zm0-294q0 79-49 151t-122 123q-376 261-468 325-10 7-42.5 30.5t-54 38-52 32.5-57.5 27-50 9h-2q-23 0-50-9t-57.5-27-52-32.5-54-38-42.5-30.5q-91-64-262-182.5t-205-142.5q-62-42-117-115.5t-55-136.5q0-78 41.5-130t118.5-52h1472q65 0 112.5 47t47.5 113z"
      />
    </svg>
  </div>
</div>

  </div>

  <hr />

  <div class="panel panel-default">
    <div class="panel-body">
      <div class="blogpost">
        <p>I’ve recently done some work in setting up myself a <a href="/paperless-ng_on_localy_hosted_rpi.html">Paperless-NG instance on a a Raspberry Pi</a> at home. Since I don’t have a lot of resources (i.e. money) to throw at it, all my data resides on a single portable hard drive; not ideal. However, being a PhD student, my university gives me 1TB of OneDrive cloud storage which I’m putting to good use for cheap, off-site data storage. Whilst this guide is for OneDrive, rclone does support <a href="https://rclone.org/docs/">43 different remotes</a> so you can adapt this guide to your needs.</p>

<p>In this guide we will set up 2 “remotes” with <a href="https://rclone.org/">RClone</a> and then use <a href="https://github.com/wolfv6/rclone_jobber">rclone_jobber</a> to easily back up our data.</p>

<p><strong>Note</strong>: Paperless-NG is now being maintained in a new fork. See <a href="/upgrading_from_paperless-ng_to_paperless_ngx.html">this post</a> for more information on upgrading.</p>

<h3 class="no_toc" id="table-of-contents">Table of Contents</h3>

<ul id="markdown-toc">
  <li><a href="#rclone" id="markdown-toc-rclone">RClone</a>    <ul>
      <li><a href="#linking-your-account-to-rclone" id="markdown-toc-linking-your-account-to-rclone">Linking your account to RClone</a></li>
      <li><a href="#creating-a-crypt-remote-within-the-onedrive-remote" id="markdown-toc-creating-a-crypt-remote-within-the-onedrive-remote">Creating a Crypt remote within the OneDrive remote</a></li>
    </ul>
  </li>
  <li><a href="#rclone_jobber" id="markdown-toc-rclone_jobber"><code class="language-plaintext highlighter-rouge">rclone_jobber</code></a></li>
  <li><a href="#cron" id="markdown-toc-cron">Cron</a></li>
  <li><a href="#conclusion" id="markdown-toc-conclusion">Conclusion</a></li>
</ul>

<blockquote>
  <p>Edit 04/10/2021: Some good comments were made on that other services exist that solve this issue out-of-the-box. I like <code class="language-plaintext highlighter-rouge">rclone</code> with <code class="language-plaintext highlighter-rouge">rclone_jobber</code> as it seamlessly does snapshots. It’s low cost and easy to set up. Please do consider other methods before mindlessly committing to mine.</p>
  <iframe id="reddit-embed" src="https://www.redditmedia.com/r/selfhosted/comments/q0l771/mods_remove_if_not_allowed_i_wrote_a_wee_guide_on/hfa7m2v/?depth=1&amp;showmore=false&amp;embed=true&amp;showmedia=false&amp;showedits=false&amp;created=2021-10-04T09%3A47%3A44.498Z" sandbox="allow-scripts allow-same-origin allow-popups" style="border: none;" scrolling="no" width="640" height="293"></iframe>
</blockquote>

<h2 id="rclone">RClone</h2>

<p>First of all, install RClone with whatever package manager you’re using. For raspberry pi, <code class="language-plaintext highlighter-rouge">sudo apt-get install rclone</code> will suffice.</p>

<p>Next we’ll have a quick look at how the aforementioned remotes work.</p>

<p><img src="/static/img/2021-10-03-scheduled-off-site-backups-for-paperless-ng-using-rclone/rclone_remotes.png" alt="RClone Remotes" /></p>

<p>What we’re going to do is create the first “remote” within OneDrive (in green on the right) that is unencrypted. This means we can sync data to this folder via the rclone cli but it’s unencrypted. I use paperless for some sensitive documents so this isn’t great. Therefore we use a “crypt” remote <strong>within</strong> the OneDrive remote (as seen in red). Remotes within remotes.</p>

<h3 id="linking-your-account-to-rclone">Linking your account to RClone</h3>

<p>Connecting to OneDrive via rclone is stupid easy. First run <code class="language-plaintext highlighter-rouge">rclone config</code> <em>on the raspberry pi</em>:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>rclone config
Current remotes:

Name                 Type
<span class="o">====</span>                 <span class="o">====</span>

e<span class="o">)</span> Edit existing remote
n<span class="o">)</span> New remote
d<span class="o">)</span> Delete remote
r<span class="o">)</span> Rename remote
c<span class="o">)</span> Copy remote
s<span class="o">)</span> Set configuration password
q<span class="o">)</span> Quit config
e/n/d/r/c/s/q&gt;</code></pre></figure>

<p>As you can see, this opens a empty menu for us with a couple commands. Hit <code class="language-plaintext highlighter-rouge">n</code> for new and type in a descriptive name such as <code class="language-plaintext highlighter-rouge">onedrive_uni</code>. After this you will see roughly 43+ different remote types for you to chose. At the time of writing, the OneDrive remote was number 26.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">Type of storage to configure.
Enter a string value. Press Enter <span class="k">for </span>the default <span class="o">(</span><span class="s2">""</span><span class="o">)</span><span class="nb">.</span>
Choose a number from below, or <span class="nb">type </span><span class="k">in </span>your own value
 1 / 1Fichier
   <span class="se">\ </span><span class="s2">"fichier"</span>
 2 / Alias <span class="k">for </span>an existing remote
   <span class="se">\ </span><span class="s2">"alias"</span>
    ...
25 / Microsoft Azure Blob Storage
   <span class="se">\ </span><span class="s2">"azureblob"</span>
26 / Microsoft OneDrive &lt;<span class="nt">--</span> THIS ONE
   <span class="se">\ </span><span class="s2">"onedrive"</span>
27 / OpenDrive
   <span class="se">\ </span><span class="s2">"opendrive"</span>
    ...
42 / premiumize.me
   <span class="se">\ </span><span class="s2">"premiumizeme"</span>
43 / seafile
   <span class="se">\ </span><span class="s2">"seafile"</span>
Storage&gt; 26</code></pre></figure>

<p>The next 2 options are <code class="language-plaintext highlighter-rouge">client_id</code> and <code class="language-plaintext highlighter-rouge">client_secret</code> which we can leave blank. The next options is region which will <em>probably</em> be “Microsoft Cloud Global” (i.e. option 1) for you.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">OAuth Client Id
Leave blank normally.
Enter a string value. Press Enter <span class="k">for </span>the default <span class="o">(</span><span class="s2">""</span><span class="o">)</span><span class="nb">.</span>
client_id&gt;
OAuth Client Secret
Leave blank normally.
Enter a string value. Press Enter <span class="k">for </span>the default <span class="o">(</span><span class="s2">""</span><span class="o">)</span><span class="nb">.</span>
client_secret&gt;
Choose national cloud region <span class="k">for </span>OneDrive.
Enter a string value. Press Enter <span class="k">for </span>the default <span class="o">(</span><span class="s2">"global"</span><span class="o">)</span><span class="nb">.</span>
Choose a number from below, or <span class="nb">type </span><span class="k">in </span>your own value
 1 / Microsoft Cloud Global &lt;<span class="nt">--</span> THIS ONE
   <span class="se">\ </span><span class="s2">"global"</span>
 2 / Microsoft Cloud <span class="k">for </span>US Government
   <span class="se">\ </span><span class="s2">"us"</span>
 3 / Microsoft Cloud Germany
   <span class="se">\ </span><span class="s2">"de"</span>
 4 / Azure and Office 365 operated by 21Vianet <span class="k">in </span>China
   <span class="se">\ </span><span class="s2">"cn"</span>
region&gt; 1</code></pre></figure>

<p>The next options allows you to edit the advanced configuration (which I have never needed to), so leave that blank and hit enter.</p>

<p>This next step is different if you’re doing this on a headless machine (such as via SSH) or one with a monitor. I will go over how to do the headless setup, but this is very similar to the non-headless one. Hit <code class="language-plaintext highlighter-rouge">n</code> and press enter.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">For this to work, you will need rclone available on a machine that has
a web browser available.

For more <span class="nb">help </span>and alternate methods see: https://rclone.org/remote_setup/

Execute the following on the machine with the web browser <span class="o">(</span>same rclone
version recommended<span class="o">)</span>:

        rclone authorize <span class="s2">"onedrive"</span>

Then <span class="nb">paste </span>the result.

Enter a string value. Press Enter <span class="k">for </span>the default <span class="o">(</span><span class="s2">""</span><span class="o">)</span><span class="nb">.</span>
config_token&gt;</code></pre></figure>

<p>As you can see, the next step requires rclone on a non-headless machine. If you’re doing the setup via SSH, this will most likely be the machine you’re physically at.</p>

<ol>
  <li>Execute `rclone authorize “onedrive”</li>
  <li>Log into Microsoft with your Office365 account as you normally would</li>
  <li>Copy the access token</li>
  <li>Paste the access token into the headless rclone instance</li>
</ol>

<p>Next up is the type of configuration which is “OneDrive Personal or Business” and will (most likely) be yours too.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">Type of connection
Enter a string value. Press Enter <span class="k">for </span>the default <span class="o">(</span><span class="s2">"onedrive"</span><span class="o">)</span><span class="nb">.</span>
Choose a number from below, or <span class="nb">type </span><span class="k">in </span>an existing value
 1 / OneDrive Personal or Business  &lt;<span class="nt">--</span> THIS ONE
   <span class="se">\ </span><span class="s2">"onedrive"</span>
 2 / Root Sharepoint site
   <span class="se">\ </span><span class="s2">"sharepoint"</span>
 3 / Sharepoint site name or URL <span class="o">(</span>e.g. mysite or https://contoso.sharepoint.com/sites/mysite<span class="o">)</span>
   <span class="se">\ </span><span class="s2">"url"</span>
 4 / Search <span class="k">for </span>a Sharepoint site
   <span class="se">\ </span><span class="s2">"search"</span>
 5 / Type <span class="k">in </span>driveID <span class="o">(</span>advanced<span class="o">)</span>
   <span class="se">\ </span><span class="s2">"driveid"</span>
 6 / Type <span class="k">in </span>SiteID <span class="o">(</span>advanced<span class="o">)</span>
   <span class="se">\ </span><span class="s2">"siteid"</span>
 7 / Sharepoint server-relative path <span class="o">(</span>advanced, e.g. /teams/hr<span class="o">)</span>
   <span class="se">\ </span><span class="s2">"path"</span>
config_type&gt; 1</code></pre></figure>

<p>The next two options are left on their defaults.</p>

<h3 id="creating-a-crypt-remote-within-the-onedrive-remote">Creating a Crypt remote within the OneDrive remote</h3>

<p>After the previous steps, we will be at the home page of <code class="language-plaintext highlighter-rouge">rclone config</code>. Once again hit <code class="language-plaintext highlighter-rouge">n</code> for new and enter a descriptive name for the remote - I went for <code class="language-plaintext highlighter-rouge">onedrive_uni_enc</code>.</p>

<p>As before, select the correct remote type which this time is “Encrypt/Decrypt a remote” and at the time of writing, was number 11.</p>

<p>The next step will ask for the location of your remote. For this guide we are focusing on OneDrive but you could chose <strong>any</strong> remote. To keep my OneDrive organised, I chose <code class="language-plaintext highlighter-rouge">onedrive_uni:backups/</code>.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">Remote to encrypt/decrypt.
Normally should contain a <span class="s1">':'</span> and a path, e.g. <span class="s2">"myremote:path/to/dir"</span>,
<span class="s2">"myremote:bucket"</span> or maybe <span class="s2">"myremote:"</span> <span class="o">(</span>not recommended<span class="o">)</span><span class="nb">.</span>
Enter a string value. Press Enter <span class="k">for </span>the default <span class="o">(</span><span class="s2">""</span><span class="o">)</span><span class="nb">.</span>
remote&gt; onedrive_uni:backups/</code></pre></figure>

<p>The next two steps focusing on the levels of encryption. I usually go for “standard” for filename encryption, and “true” for directory encryption.</p>

<p>Be very careful in these next steps as once you’ve entered your password and salt, you cannot retrieve it again without repeating the whole process. Furthermore, if you do not backup your keys and lose the config through hard drive failure or whatnot, then all your backed up data is <strong>GONE</strong>. For this, I use <a href="https://bitwarden.com/">bitwarden’s</a> secure notes.</p>

<p>My configuration for the password and salt can be seen below. I chose 128 bit keys but you can go for whatever you like.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">Password or pass phrase <span class="k">for </span>encryption.
y<span class="o">)</span> Yes <span class="nb">type </span><span class="k">in </span>my own password
g<span class="o">)</span> Generate random password
y/g&gt; g
Password strength <span class="k">in </span>bits.
64 is just about memorable
128 is secure
1024 is the maximum
Bits&gt; 128
Your password is: ob2FY5mNFQ37KksdCqP3VQ
Use this password? Please note that an obscured version of this
password <span class="o">(</span>and not the password itself<span class="o">)</span> will be stored under your
configuration file, so keep this generated password <span class="k">in </span>a safe place.
y<span class="o">)</span> Yes <span class="o">(</span>default<span class="o">)</span>
n<span class="o">)</span> No
y/n&gt; y
Password or pass phrase <span class="k">for </span>salt. Optional but recommended.
Should be different to the previous password.
y<span class="o">)</span> Yes <span class="nb">type </span><span class="k">in </span>my own password
g<span class="o">)</span> Generate random password
n<span class="o">)</span> No leave this optional password blank <span class="o">(</span>default<span class="o">)</span>
y/g/n&gt; g
Password strength <span class="k">in </span>bits.
64 is just about memorable
128 is secure
1024 is the maximum
Bits&gt; 128
Your password is: NrBo2D52xdgGfOnA-BjHVw
Use this password? Please note that an obscured version of this
password <span class="o">(</span>and not the password itself<span class="o">)</span> will be stored under your
configuration file, so keep this generated password <span class="k">in </span>a safe place.
y<span class="o">)</span> Yes <span class="o">(</span>default<span class="o">)</span>
n<span class="o">)</span> No
y/n&gt; y</code></pre></figure>

<p>Once again, leave the final two options as default.</p>

<h2 id="rclone_jobber"><code class="language-plaintext highlighter-rouge">rclone_jobber</code></h2>

<p>Strictly speaking, <code class="language-plaintext highlighter-rouge">rclone_jobber</code> is not required. A bash one-liner using <code class="language-plaintext highlighter-rouge">rclone sync</code> would be enough. However, cloning the repo and using the script means consistent results across any device, plus I like how it does the backups for me.</p>

<p>Execute the following 3 lines</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="c"># Clone the repo</span>
<span class="nv">$ </span>git clone https://github.com/wolfv6/rclone_jobber /opt/rclone_jobber

<span class="c"># Move into the folder</span>
<span class="nv">$ </span><span class="nb">cd</span> /opt/rclone_jobber

<span class="c"># Copy the example script into the top level directory</span>
<span class="nv">$ </span><span class="nb">cp </span>examples/job_backup_to_remote.sh ./

<span class="c"># Create the filter_rules file</span>
<span class="nv">$ </span><span class="nb">touch </span>filter_rules</code></pre></figure>

<p>The original script uses environmental variables, but I prefer hard-coding these values. Skip these steps if you would rather not.</p>

<ol>
  <li>Change <code class="language-plaintext highlighter-rouge">rclone_jobber=$rclone_jobber</code> to <code class="language-plaintext highlighter-rouge">rclone_jobber=/opt/rclone_jobber</code></li>
  <li>Change <code class="language-plaintext highlighter-rouge">source="$HOME/test_rclone_data"</code> to wherever your paperless data is kept such as <code class="language-plaintext highlighter-rouge">source=/media/PORTABLE_UN/paperless</code></li>
  <li>Change <code class="language-plaintext highlighter-rouge">dest="${remote}:"</code> to <code class="language-plaintext highlighter-rouge">dest=onedrive_enc:paperless</code></li>
  <li>Change <code class="language-plaintext highlighter-rouge">options="--filter-from=$rclone_jobber/examples/filter_rules"</code> to <code class="language-plaintext highlighter-rouge">options="--filter-from=$rclone_jobber/filter_rules"</code></li>
  <li>Optional: Create a monitoring URL on something like <a href="https://healthchecks.io/">healthchecks.io</a> and set <code class="language-plaintext highlighter-rouge">monitoring_URL</code> equal to this URL</li>
</ol>

<p>My final <code class="language-plaintext highlighter-rouge">job_backup_to_remote.sh</code> looks like this:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="c">#!/usr/bin/env sh</span>

<span class="c">################################### license ##################################</span>
<span class="c"># job_backup_to_remote.sh calls rclone_jobber to perform a backup to remote.</span>
<span class="c"># Written in 2018 by Wolfram Volpi, contact at https://github.com/wolfv6/rclone_jobber/issues.</span>
<span class="c"># To the extent possible under law, the author(s) have dedicated all copyright and related and neighboring rights to this software to the public domain worldwide.</span>
<span class="c"># This software is distributed without any warranty.</span>
<span class="c"># You should have received a copy of the CC0 Public Domain Dedication along with this software. If not, see http://creativecommons.org/publicdomain/zero/1.0/.</span>
<span class="c"># rclone_jobber is not affiliated with rclone.</span>
<span class="c">##############################################################################</span>

<span class="c">#this script uses these user-defined environment variables: rclone_jobber, remote</span>
<span class="nv">rclone_jobber</span><span class="o">=</span>/media/PORTABLE_UN/rclone_jobber <span class="c">#path to rclone_jobber directory</span>

<span class="nb">source</span><span class="o">=</span><span class="s2">"/media/PORTABLE_UN/paperless/"</span>
<span class="nv">dest</span><span class="o">=</span><span class="s2">"onedrive_enc:"</span>
<span class="nv">move_old_files_to</span><span class="o">=</span><span class="s2">"dated_directory"</span>
<span class="nv">options</span><span class="o">=</span><span class="s2">"--filter-from=</span><span class="nv">$rclone_jobber</span><span class="s2">/filter_rules -L -v"</span> &lt;<span class="nt">--</span> Optional <span class="nt">-L</span> <span class="o">(</span>follow symlinks<span class="o">)</span> and <span class="nt">-v</span> <span class="o">(</span>increase log level<span class="o">)</span> flags 
<span class="nv">monitoring_URL</span><span class="o">=</span><span class="s2">"REDACTED"</span>

<span class="nv">$rclone_jobber</span>/rclone_jobber.sh <span class="s2">"</span><span class="nv">$source</span><span class="s2">"</span> <span class="s2">"</span><span class="nv">$dest</span><span class="s2">"</span> <span class="s2">"</span><span class="nv">$move_old_files_to</span><span class="s2">"</span> <span class="s2">"</span><span class="nv">$options</span><span class="s2">"</span> <span class="s2">"</span><span class="si">$(</span><span class="nb">basename</span> <span class="nv">$0</span><span class="si">)</span><span class="s2">"</span> <span class="s2">"</span><span class="nv">$monitoring_URL</span><span class="s2">"</span></code></pre></figure>

<p>We then need to create the <code class="language-plaintext highlighter-rouge">filter_rules</code> file. My current setup just excludes the <code class="language-plaintext highlighter-rouge">consume</code> and <code class="language-plaintext highlighter-rouge">export</code> directories and looks like:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span><span class="nb">cat </span>filter_rules
- consume/<span class="k">**</span>
- <span class="nb">export</span>/<span class="k">**</span></code></pre></figure>

<h2 id="cron">Cron</h2>

<p>To automate this process we need to use a scheduler, such as <code class="language-plaintext highlighter-rouge">cron</code>. <code class="language-plaintext highlighter-rouge">cron</code> is great as it is pre-installed on every linux OS as far as I am aware.</p>

<p>Begin editing the crontab with <code class="language-plaintext highlighter-rouge">cron -e</code>. Add the following to the end of it:</p>

<figure class="highlight"><pre><code class="language-cron" data-lang="cron">0 2 * * * /opt/rclone_jobber/job_backup_to_remote.sh</code></pre></figure>

<p>This reads as “run <code class="language-plaintext highlighter-rouge">/opt/rclone_jobber/job_backup_to_remote.sh</code> at 2:00 am every day”. You may edit this to suit your needs. Note, however, that rclone is smart enough to only update the backup with new data.</p>

<h2 id="conclusion">Conclusion</h2>

<p>Using FOSS tools like <code class="language-plaintext highlighter-rouge">rclone</code>, <code class="language-plaintext highlighter-rouge">rclone_jobber</code>, and <code class="language-plaintext highlighter-rouge">cron</code> enables us to use any off-site data storage we desire. From google drive to onedrive, ssh to ftp. Paperless-ng is super powerful but what is all that worth if you lose your data. ALWAYS BACK-UP YOUR FILES.</p>


        <hr />
        <div class="related-posts">
          <h5>Related Posts</h5>
          
          <div class="row row-cols-sm-1 row-cols-md-2 row-cols-lg-2">
            <div class="col-sm-4 col-md-4 col-lg-4">
              <h6 class="text-sm-start text-md-end text-lg-end">
                September 25, 2021
              </h6>
            </div>
            <div class="col-sm-8 col-md-8 col-lg-8">
              <h6 class="text-start">
                <a
                  class="text-decoration-none plausible-event-name=Related+Post+Click"
                  href="/paperless-ng_on_localy_hosted_rpi.html"
                  >Paperless-ng On Raspberry Pi With Email And Samba</a
                >
              </h6>
            </div>
          </div>
          
          <div class="row row-cols-sm-1 row-cols-md-2 row-cols-lg-2">
            <div class="col-sm-4 col-md-4 col-lg-4">
              <h6 class="text-sm-start text-md-end text-lg-end">
                March 22, 2022
              </h6>
            </div>
            <div class="col-sm-8 col-md-8 col-lg-8">
              <h6 class="text-start">
                <a
                  class="text-decoration-none plausible-event-name=Related+Post+Click"
                  href="/pydantic_vs_protobuf_vs_namedtuple_vs_dataclasses.html"
                  >Pydantic vs Protobuf vs Namedtuples vs Dataclasses</a
                >
              </h6>
            </div>
          </div>
          
          <div class="row row-cols-sm-1 row-cols-md-2 row-cols-lg-2">
            <div class="col-sm-4 col-md-4 col-lg-4">
              <h6 class="text-sm-start text-md-end text-lg-end">
                January  7, 2022
              </h6>
            </div>
            <div class="col-sm-8 col-md-8 col-lg-8">
              <h6 class="text-start">
                <a
                  class="text-decoration-none plausible-event-name=Related+Post+Click"
                  href="/how_to_make_your_blog_searchable.html"
                  >How To Make Your Blog Searchable Using Algolia</a
                >
              </h6>
            </div>
          </div>
          
        </div>
      </div>
    </div>
  </div>
  <div id="comments"></div>
  <script
  src="https://utteranc.es/client.js"
  repo="iwishiwasaneagle/janhendrikewers.uk"
  issue-term="pathname"
  theme="github-light"
  crossorigin="anonymous"
  async
></script>

</div>

    </div>

    <!-- Footer -->
    <footer class="mt-auto py-3">
  <div class="container">
    <span class="text-muted"
      >© All rights reserved. Contribute at
      <a href="https://github.com/iwishiwasaneagle/janhendrikewers.uk">
        GitHub</a
      >. Powered by <a href="http://jekyllrb.com/">Jekyll</a> with ♥</span
    >
  </div>
</footer>

  </body>
</html>
