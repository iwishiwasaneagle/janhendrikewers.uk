<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  
    <title type="text" xml:lang="en">Jan-Hendrik Ewers</title>
    <link type="application/atom+xml" rel="self" href="https://janhendrikewers.uk/atom.xml"/>
  
  <link href="https://janhendrikewers.uk/"/>
  <id>https://janhendrikewers.uk/</id>
  <updated>2023-03-07T16:50:13Z</updated>
  <author>
    <name>Jan-Hendrik Ewers</name>
    <email>j.ewers.1@research.gla.ac.uk</email>
  </author>
  <rights type="text">Copyright © 2023 Jan-Hendrik Ewers. All rights reserved.</rights>
  
  <entry>
    <title type="text">How Your Psychological Profile Is Used In A Mountain Rescue Search</title>
    <link rel="alternate" type="text/html" href="https://janhendrikewers.uk/how_your_psychological_profile_is_used_in_a_mountain_rescue_search.html" />
    <id>https://janhendrikewers.uk/how_your_psychological_profile_is_used_in_a_mountain_rescue_search</id>
    <published>2023-03-07T00:00:00Z</published>
    <updated>2023-03-07T00:00:00Z</updated>
    <content type="html"><![CDATA[ <p>When you (or actually, anyone) gets lost in the mountains, a group of experts get called out with one task: find you, and get you back to safety. They use a myriad of tools to do this, with the one we’ll focus on in this post being <strong>data</strong>.</p>

<hr />

<blockquote>
  <p><em>Note: I’m not a mountain rescue expert, so everything written here should be taken with a pinch of salt.</em></p>
</blockquote>

<hr />

<p>You may not know this, but lost people behave massively different based on their gender, age, health, and current activity. We know this from historical data gathered over hundreds of Search and Rescue (SAR) incidents carefully catalogued and processed by various groups (<a href="https://www.scottishmountainrescue.org/">SMR</a>, <a href="https://www.mountain.rescue.org.uk/">EWMR</a>, Police, <a href="https://www.dbs-sar.com/SAR_Research/ISRID.htm">ISRID</a>, etc.). This data is usually very top-level, like how long they were travelling for, where they were found, how far from a road were they found, etc.</p>

<p>Using this, we can construct a model that matches as closely as possible to the data and through this predict where a person might be found from a report last place seen (LPS). This model may not be anything formal, but rather to inform the search leader about where their searches need to look. If profile A is likely to be near a lake, then look near the lake! If profile B is highly likely to not travel longer than 5 hours, restrict your search area.</p>

<p>One data source that is commonly used throughout the UK is the <em>UK Missing Person Behaviour Study</em> <sup id="fnref:fn2" role="doc-noteref"><a href="#fn:fn2" class="footnote" rel="footnote">1</a></sup>. This tells us that <em>Children aged 1 to 16 years</em> have a $52\%$ chance of being found near building, and in comparison a person suffering from <em>Dementia</em> is only found near buildings $26\%$ of the time<sup id="fnref:fn1" role="doc-noteref"><a href="#fn:fn1" class="footnote" rel="footnote">2</a></sup>.</p>

<p>A caveat to this is that it’s important to make the distinction between environment types. Someone lost in the Scottish Highlands will have a much harder time traversing the terrain, than someone lost in Yorkshire. As well as this, there is usually no distinction made on time-of-day or the weather conditions In the data. However, through chatting to mountain rescue experts from the Lake District<sup id="fnref:fn3" role="doc-noteref"><a href="#fn:fn3" class="footnote" rel="footnote">3</a></sup>, they automatically search down-wind from the LPS as <em>who in their right mind walks into the wind when they’re already struggling to locate themselves or injured</em>.</p>

<p>Whilst you may never use this information, I find it really interesting to know what tools are being used by the experts saving lives. My current research is in the field of predicting and searching for lost people using <a href="https://github.com/iwishiwasaneagle/jdrones">drones</a>, so it’s nice to share a niche slice of my work.</p>

<hr />

<blockquote>
  <p><strong>N.B. (1)</strong>: The mountains are a beautiful, yet dangerous place. Mountain rescuers literally put their life on line to help people on the regular with (usually) no compensation. In Scotland, the individual teams rely on donations as the funding from the government is marginal. So please be careful and don’t take their efforts for granted.</p>

  <p><strong>N.B. (2):</strong> If this blog post piqued your interest about the niche that is mountain rescue, the book <em>Cairngorm John: a Life in Mountain Rescue</em> by John Allen is a fascinating insight into how search and rescue scenarios play out.</p>
</blockquote>

<hr />

<div class="footnotes" role="doc-endnotes">
  <ol>
    <li id="fn:fn2" role="doc-endnote">
      <p>D. Perkins, P. Roberts, G. Feeney, and P. Mrt, ‘The U.K. Missing Person Behaviour Study’, CSR, 2011, [Online]. Available: https://tcsr.org.uk/media/kushuk1a/uk-missing-person-behaviour-study-2011.pdf <a href="#fnref:fn2" class="reversefootnote" role="doc-backlink">&#8617;</a></p>
    </li>
    <li id="fn:fn1" role="doc-endnote">
      <p>This is for the <em>farmland</em> terrain, and <em>female</em> gender for the dementia category. The child 1-16 category does not report on gender. <a href="#fnref:fn1" class="reversefootnote" role="doc-backlink">&#8617;</a></p>
    </li>
    <li id="fn:fn3" role="doc-endnote">
      <p>Fun fact: Lake District Mountain Rescue don’t just search for humans, but animals too! <a href="#fnref:fn3" class="reversefootnote" role="doc-backlink">&#8617;</a></p>
    </li>
  </ol>
</div>
 ]]></content>
  </entry>

  <entry>
    <title type="text">Pip Install From Private GitHub Repos</title>
    <link rel="alternate" type="text/html" href="https://janhendrikewers.uk/pip_install_from_private_repos.html" />
    <id>https://janhendrikewers.uk/pip_install_from_private_repos</id>
    <published>2023-02-07T00:00:00Z</published>
    <updated>2023-02-07T00:00:00Z</updated>
    <content type="html"><![CDATA[ <p>I’m currently working on a <a href="https://github.com/iwishiwasaneagle/jdrones">library</a> that I’m not quite ready yet to open source. I use it for research, and as such need to be able to install it on other machines. Originally I was just cloning the repo and setting <code class="language-plaintext highlighter-rouge">PYTHONPATH</code> everywhere but this quickly became cumbersome. Below are the methods that I’ve discovered to install the library.</p>

<h2 id="https">HTTPS</h2>

<p>So you don’t want to set up SSH with a private key and all that jazz. Simply have a look at <a href="https://docs.github.com/en/authentication/keeping-your-account-and-data-secure/creating-a-personal-access-token">this</a> guide to create a private access token (PAT) with <strong>read</strong> access to the private repo.</p>

<p>Then run the following</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pip <span class="nb">install </span>git+https://<span class="nv">$USERNAME</span>:<span class="nv">$PAT</span>@github.com/<span class="nv">$GH_USER</span>/<span class="nv">$REPO</span>.git@<span class="nv">$VERSION</span>
</code></pre></div></div>

<p>Some other guides online either omit the $USERNAME because it’s a new requirement or it used to work, but this is the only way it works for me these days <strong>without</strong> asking for my password.</p>

<h2 id="ssh">SSH</h2>

<p>This is by far the easiest method, but it does require that <a href="https://docs.github.com/en/authentication/connecting-to-github-with-ssh">SSH is linked to your github account</a>. If SSH is correctly set up, then run the following</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pip <span class="nb">install </span>git+ssh://git@github.com/<span class="nv">$GH_USER</span>/<span class="nv">$REPO</span>.git@<span class="nv">$VERSION</span>
</code></pre></div></div>

<h2 id="extra-info">Extra Info</h2>

<ul>
  <li><code class="language-plaintext highlighter-rouge">$VERSION</code> can be a branch or tag</li>
  <li>PATs should <strong>always</strong> have the <strong>minimum</strong> permissions possible
    <ul>
      <li>GitHub’s new <a href="https://github.com/settings/tokens?type=beta">fine-grained tokens</a> give you per-repo control</li>
    </ul>
  </li>
  <li>Treat your PATs like a password. DO NOT SHARE</li>
</ul>
 ]]></content>
  </entry>

  <entry>
    <title type="text">Exploring Faster Alternatives To np.clip</title>
    <link rel="alternate" type="text/html" href="https://janhendrikewers.uk/exploring_faster_np_clip.html" />
    <id>https://janhendrikewers.uk/exploring_faster_np_clip</id>
    <published>2023-01-24T00:00:00Z</published>
    <updated>2023-01-24T00:00:00Z</updated>
    <content type="html"><![CDATA[ <p>I was profiling some code I had written where <code class="language-plaintext highlighter-rouge">np.clip</code> was being called a couple hundreds of millions of times. The profiler was flagging some weird related functions that seemed unimportant so I delved deeper. Turns out that as of numpy 1.17, the <code class="language-plaintext highlighter-rouge">np.clip</code> has been substantially slower than previously which has been documented <a href="https://github.com/numpy/numpy/issues/14281">here</a>. This caught my curiosity and after some experimentation I found two substantially faster methods which in turn sped up my code by $50\%$!</p>

<p>Below is my log of what I tried, but if you just want results then <a href="#conclusion">here</a> is your link.</p>

<p><strong>Note</strong>: These tests were undertaken using numpy version <code class="language-plaintext highlighter-rouge">1.23.5</code>.</p>

<h2 id="scalar">Scalar</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">VMIN</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.5</span>
<span class="n">VMAX</span> <span class="o">=</span> <span class="mf">0.5</span>
<span class="n">X_scalar</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="nf">rand</span><span class="p">()</span> <span class="o">-</span> <span class="mf">0.5</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">np</span><span class="p">.</span><span class="nf">clip</span><span class="p">(</span><span class="n">X_scalar</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>
<span class="o">&gt;</span> <span class="mf">11.3</span> <span class="n">µs</span> <span class="err">±</span> <span class="mi">202</span> <span class="n">ns</span> <span class="n">per</span> <span class="nf">loop </span><span class="p">(</span><span class="n">mean</span> <span class="err">±</span> <span class="n">std</span><span class="p">.</span> <span class="n">dev</span><span class="p">.</span> <span class="n">of</span> <span class="mi">7</span> <span class="n">runs</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span><span class="mi">000</span> <span class="n">loops</span> <span class="n">each</span><span class="p">)</span>
</code></pre></div></div>

<p>Testing the baseline gave us a fairly decent time of $11.3\mu s$.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">np</span><span class="p">.</span><span class="n">core</span><span class="p">.</span><span class="n">umath</span><span class="p">.</span><span class="nf">maximum</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">core</span><span class="p">.</span><span class="n">umath</span><span class="p">.</span><span class="nf">minimum</span><span class="p">(</span><span class="n">X_scalar</span><span class="p">,</span> <span class="n">VMAX</span><span class="p">),</span> <span class="n">VMIN</span><span class="p">)</span>
<span class="o">&gt;</span> <span class="mf">2.25</span> <span class="n">µs</span> <span class="err">±</span> <span class="mf">64.6</span> <span class="n">ns</span> <span class="n">per</span> <span class="nf">loop </span><span class="p">(</span><span class="n">mean</span> <span class="err">±</span> <span class="n">std</span><span class="p">.</span> <span class="n">dev</span><span class="p">.</span> <span class="n">of</span> <span class="mi">7</span> <span class="n">runs</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span><span class="mi">000</span> <span class="n">loops</span> <span class="n">each</span><span class="p">)</span>
</code></pre></div></div>

<p>However, we quickly got huge gains by using max/min functions directly.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">np</span><span class="p">.</span><span class="nf">max</span><span class="p">([</span><span class="n">np</span><span class="p">.</span><span class="nf">min</span><span class="p">([</span><span class="n">X_scalar</span><span class="p">,</span> <span class="n">VMAX</span><span class="p">]),</span> <span class="n">VMIN</span><span class="p">])</span>
<span class="o">&gt;</span> <span class="mf">8.74</span> <span class="n">µs</span> <span class="err">±</span> <span class="mi">141</span> <span class="n">ns</span> <span class="n">per</span> <span class="nf">loop </span><span class="p">(</span><span class="n">mean</span> <span class="err">±</span> <span class="n">std</span><span class="p">.</span> <span class="n">dev</span><span class="p">.</span> <span class="n">of</span> <span class="mi">7</span> <span class="n">runs</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span><span class="mi">000</span> <span class="n">loops</span> <span class="n">each</span><span class="p">)</span>
</code></pre></div></div>

<p>Using the normal max/min functions proved still faster but not nearly as fast as calling the <code class="language-plaintext highlighter-rouge">umath</code> functions directly.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">VMIN</span> <span class="k">if</span> <span class="n">X_scalar</span> <span class="o">&lt;</span> <span class="n">VMIN</span> <span class="k">else</span> <span class="n">VMAX</span> <span class="k">if</span> <span class="n">X_scalar</span> <span class="o">&gt;</span> <span class="n">VMAX</span> <span class="k">else</span> <span class="n">X_scalar</span>
<span class="o">&gt;</span> <span class="mf">75.2</span> <span class="n">ns</span> <span class="err">±</span> <span class="mf">7.8</span> <span class="n">ns</span> <span class="n">per</span> <span class="nf">loop </span><span class="p">(</span><span class="n">mean</span> <span class="err">±</span> <span class="n">std</span><span class="p">.</span> <span class="n">dev</span><span class="p">.</span> <span class="n">of</span> <span class="mi">7</span> <span class="n">runs</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span><span class="mi">000</span><span class="p">,</span><span class="mi">000</span> <span class="n">loops</span> <span class="n">each</span><span class="p">)</span>
</code></pre></div></div>

<p>For scalars, there is not much faster than direct logic in python it seems. Huge gains!</p>

<h2 id="array">Array</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">X_array</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="nf">rand</span><span class="p">(</span><span class="mi">50000</span><span class="p">)</span> <span class="o">-</span> <span class="n">VMAX</span><span class="p">)</span>
</code></pre></div></div>
<p>Again, testing the baseline:</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">np</span><span class="p">.</span><span class="nf">clip</span><span class="p">(</span><span class="n">X_array</span><span class="p">,</span> <span class="n">VMIN</span><span class="p">,</span> <span class="n">VMAX</span><span class="p">)</span>
<span class="o">&gt;</span> <span class="mi">172</span> <span class="n">µs</span> <span class="err">±</span> <span class="mi">646</span> <span class="n">ns</span> <span class="n">per</span> <span class="nf">loop </span><span class="p">(</span><span class="n">mean</span> <span class="err">±</span> <span class="n">std</span><span class="p">.</span> <span class="n">dev</span><span class="p">.</span> <span class="n">of</span> <span class="mi">7</span> <span class="n">runs</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span><span class="mi">000</span> <span class="n">loops</span> <span class="n">each</span><span class="p">)</span>
</code></pre></div></div>

<p>This gave us a very slow time of $172\mu s$ which isn’t good enough. Since using the usual min/max functions proved fruitless in the scalar case, we skip it here.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">np</span><span class="p">.</span><span class="n">core</span><span class="p">.</span><span class="n">umath</span><span class="p">.</span><span class="nf">maximum</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">core</span><span class="p">.</span><span class="n">umath</span><span class="p">.</span><span class="nf">minimum</span><span class="p">(</span><span class="n">X_array</span><span class="p">,</span> <span class="n">VMAX</span><span class="p">),</span> <span class="n">VMIN</span><span class="p">)</span>
<span class="o">&gt;</span> <span class="mf">40.9</span> <span class="n">µs</span> <span class="err">±</span> <span class="mi">388</span> <span class="n">ns</span> <span class="n">per</span> <span class="nf">loop </span><span class="p">(</span><span class="n">mean</span> <span class="err">±</span> <span class="n">std</span><span class="p">.</span> <span class="n">dev</span><span class="p">.</span> <span class="n">of</span> <span class="mi">7</span> <span class="n">runs</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span><span class="mi">000</span> <span class="n">loops</span> <span class="n">each</span><span class="p">)</span>
</code></pre></div></div>

<p>Again, the <code class="language-plaintext highlighter-rouge">umath</code> functions were faster.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">np</span><span class="p">.</span><span class="nf">asarray</span><span class="p">([</span><span class="n">VMIN</span> <span class="k">if</span> <span class="n">Xi</span> <span class="o">&lt;</span> <span class="n">VMIN</span> <span class="k">else</span> <span class="n">VMAX</span> <span class="k">if</span> <span class="n">Xi</span> <span class="o">&gt;</span> <span class="n">VMAX</span> <span class="k">else</span> <span class="n">Xi</span> <span class="k">for</span> <span class="n">Xi</span> <span class="ow">in</span> <span class="n">X_array</span><span class="p">])</span>
<span class="o">&gt;</span> <span class="mi">10</span> <span class="n">ms</span> <span class="err">±</span> <span class="mi">140</span> <span class="n">µs</span> <span class="n">per</span> <span class="nf">loop </span><span class="p">(</span><span class="n">mean</span> <span class="err">±</span> <span class="n">std</span><span class="p">.</span> <span class="n">dev</span><span class="p">.</span> <span class="n">of</span> <span class="mi">7</span> <span class="n">runs</span><span class="p">,</span> <span class="mi">100</span> <span class="n">loops</span> <span class="n">each</span><span class="p">)</span>
</code></pre></div></div>

<p>And (as expected honestly) the raw python variation was horribly slow.</p>

<h2 id="conclusion">Conclusion</h2>

<p>For scalars, using <code class="language-plaintext highlighter-rouge">VMIN if X &lt; VMIN else VMAX if X &gt; VMAX else X</code> is 150x faster than normal <code class="language-plaintext highlighter-rouge">np.clip</code>. However, using raw python for arrays is (expectedly) horrible. For this case, using <code class="language-plaintext highlighter-rouge">np.core.umath.maximum(np.core.umath.minimum(X, VMAX), VMIN)</code> is roughly 4x faster than <code class="language-plaintext highlighter-rouge">np.clip</code>.</p>

<h3 id="credit">Credit</h3>

<p>I got most of these ideas from <a href="https://github.com/numpy/numpy/issues/14281">numpy#14281</a> but wanted to verify them for myself.</p>
 ]]></content>
  </entry>

  <entry>
    <title type="text">How To Block YouTube Shorts In Your Feed And Inbox</title>
    <link rel="alternate" type="text/html" href="https://janhendrikewers.uk/how_to_block_youtube_shorts_in_your_feed.html" />
    <id>https://janhendrikewers.uk/how_to_block_youtube_shorts_in_your_feed</id>
    <published>2023-01-23T00:00:00Z</published>
    <updated>2023-01-23T00:00:00Z</updated>
    <content type="html"><![CDATA[ <p>YouTube shorts are becoming more and more prevalent on the website. I was completely okay with this until my subscriptions and feed were starting to become completely unbearable with their presence. The nature of shorts means that content creators are uploading these clips on a much higher rate than anything else resulting in this mess. Furthermore, there is NO way of doing this natively within the website. Hopefully this short guide will help someone with the same issue.</p>

<h2 id="how-to">How To</h2>

<p>First of all you need to install uBlock Origin (<a href="https://chrome.google.com/webstore/detail/ublock-origin/cjpalhdlnbpafiamejdnhcphjbkeiagm?hl=en">Chrome</a>, <a href="https://addons.mozilla.org/en-GB/firefox/addon/ublock-origin/">Firefox</a>). Then, open the settings page via the add-on’s pop-up</p>

<p class="centre"><img src="/static/img/2023-01-23-youtube_shorts/a.png" alt="uBlock Origin settings button" class="img-responsive" />
<em>uBlock Origin settings button location</em></p>

<p>Finally, all you need to do is import the custom filter from <a href="https://letsblock.it/filters/youtube-shorts">here</a> within the <em>My filters</em> tab.</p>

<h2 id="results">Results</h2>

<p>This method works exceptionally well. As you can see, there are <strong>NO</strong> shorts in a subset of my subscriptions after implementing this method.</p>

<p class="centre"><img src="/static/img/2023-01-23-youtube_shorts/b.png" alt="Before" class="img-responsive" />
<em>Before</em></p>

<p class="centre"><img src="/static/img/2023-01-23-youtube_shorts/c.png" alt="Before" class="img-responsive" />
<em>After</em></p>
 ]]></content>
  </entry>

  <entry>
    <title type="text">Using GMail&apos;s App Passwords With Paperless-NGX</title>
    <link rel="alternate" type="text/html" href="https://janhendrikewers.uk/gmail_app_password_with_paperless-ngx.html" />
    <id>https://janhendrikewers.uk/gmail_app_password_with_paperless-ngx</id>
    <published>2022-10-09T00:00:00Z</published>
    <updated>2022-10-09T00:00:00Z</updated>
    <content type="html"><![CDATA[ <p>I saw some errors in my paperless-ngx logs recently:</p>

<pre><code class="language-log">[2022-11-09 15:33:13,556] [ERROR] [paperless_mail] 
  Error while authenticating account paperless gmail: 
    Response status "OK" expected, but "NO" received. 
    Data: [b'[AUTHENTICATIONFAILED] Invalid credentials (Failure)']
</code></pre>

<p>After doing some digging, I discovered the following that will be affecting a lot of Paperless-ngx users with dedicated gmail accounts for ingress.</p>

<p>As of 30/05/2022, <a href="https://support.google.com/accounts/answer/6010255">Google stopped supporting the <em>Less Secure Apps</em> mode</a> which was often used to enable Paperless-NG to work with GMail via IMAP. Now, you need to enable 2FA and then generate an <em>App Password</em> (with instructions <a href="https://support.google.com/accounts/answer/185833">here</a>). This password is then used within paperless-ngx like the account password previously.</p>

<p>For more guidance on how to set up Paperless-ngx with automated email ingress and rules, have a look at my other article <a href="/paperless-ng_on_localy_hosted_rpi.html">here</a></p>

<h2 id="tips">Tips</h2>

<ol>
  <li>Make sure to select <strong>Mail</strong> as the app type. You’ll then want to select <em>Other Custom Name</em> for the device type.
<img src="/static/img/2022-11-09_gmail_with_paperless-ngx/2.png" alt="B" /></li>
  <li>Make sure to use a meaningful name
<img src="/static/img/2022-11-09_gmail_with_paperless-ngx/3.png" alt="C" /></li>
  <li>The app password is only ever shown once so make sure to copy it there and then. It is made up of 16 characters. <strong>DO NOT SHARE OR RE-USE THIS PASSWORD</strong>
<img src="/static/img/2022-11-09_gmail_with_paperless-ngx/4.png" alt="D" /></li>
</ol>
 ]]></content>
  </entry>

  <entry>
    <title type="text">One Python Import Quirk You Need to Know, Or Why The Heck Is That A Function?</title>
    <link rel="alternate" type="text/html" href="https://janhendrikewers.uk/how-do-python-imports-work.html" />
    <id>https://janhendrikewers.uk/how-do-python-imports-work</id>
    <published>2022-09-12T00:00:00Z</published>
    <updated>2022-09-12T00:00:00Z</updated>
    <content type="html"><![CDATA[ <p>Any budding python program has been there. You’ve just made a wonderful new project with an amazingly descriptive file structure! Well done you!</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>foo
├── bar
│   ├── bar.py
│   └── __init__.py
└── __init__.py
</code></pre></div></div>

<p>Now, <code class="language-plaintext highlighter-rouge">foo/__init__.py</code> is empty making foo a module, and since <code class="language-plaintext highlighter-rouge">foo/bar</code> also has a <code class="language-plaintext highlighter-rouge">__init__.py</code> file, it is a submodule. For the purposes of this little demonstration, the files are as follows:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># foo/bar/__init__.py
</span><span class="kn">from</span> <span class="n">.bar</span> <span class="kn">import</span> <span class="n">bar</span>

<span class="c1"># foo/bar/bar.py
</span><span class="s">"""
This is a really important module!
"""</span>

<span class="k">def</span> <span class="nf">bar</span><span class="p">():</span>
    <span class="nf">print</span><span class="p">(</span><span class="s">"Hello, World!"</span><span class="p">)</span>
</code></pre></div></div>

<p>Everything works real nicely except you find yourself needing to call <code class="language-plaintext highlighter-rouge">help()</code> on the <code class="language-plaintext highlighter-rouge">bar</code> sub-submodule (i.e. <code class="language-plaintext highlighter-rouge">foo.bar.bar</code> not <code class="language-plaintext highlighter-rouge">foo.bar.bar.bar</code>). How do we do this?</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="n">foo.bar</span> <span class="kn">import</span> <span class="n">bar</span>

<span class="o">&gt;&gt;&gt;</span> <span class="nf">help</span><span class="p">(</span><span class="n">bar</span><span class="p">)</span>
<span class="n">Help</span> <span class="n">on</span> <span class="n">function</span> <span class="n">bar</span> <span class="ow">in</span> <span class="n">module</span> <span class="n">foo</span><span class="p">.</span><span class="n">bar</span><span class="p">.</span><span class="n">bar</span><span class="p">:</span>

<span class="nf">bar</span><span class="p">()</span>
</code></pre></div></div>

<p>Well, that was expected right? Let’s try something different…</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span> <span class="n">foo.bar.bar</span>

<span class="o">&gt;&gt;&gt;</span> <span class="nf">help</span><span class="p">(</span><span class="n">foo</span><span class="p">.</span><span class="n">bar</span><span class="p">.</span><span class="n">bar</span><span class="p">)</span>
<span class="n">Help</span> <span class="n">on</span> <span class="n">function</span> <span class="n">bar</span> <span class="ow">in</span> <span class="n">module</span> <span class="n">foo</span><span class="p">.</span><span class="n">bar</span><span class="p">.</span><span class="n">bar</span><span class="p">:</span>

<span class="nf">bar</span><span class="p">()</span>
</code></pre></div></div>

<p>Shoot! Same again.</p>

<p>How about…</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span> <span class="n">foo.bar</span> <span class="k">as</span> <span class="n">b</span>

<span class="o">&gt;&gt;&gt;</span> <span class="nf">help</span><span class="p">(</span><span class="n">b</span><span class="p">.</span><span class="n">bar</span><span class="p">)</span>
<span class="n">Help</span> <span class="n">on</span> <span class="n">function</span> <span class="n">baz</span> <span class="ow">in</span> <span class="n">module</span> <span class="n">foo</span><span class="p">.</span><span class="n">bar</span><span class="p">.</span><span class="n">bar</span><span class="p">:</span>

<span class="nf">baz</span><span class="p">()</span>
</code></pre></div></div>

<p>You see what’s going on here?</p>

<p>Because we’ve named our function the same as the submodule(yes, <code class="language-plaintext highlighter-rouge">bar.py</code> is being treated as a submodule within the submodule <code class="language-plaintext highlighter-rouge">bar</code>), and we’re <strong>OVERWRITING</strong> the submodule’s name in <code class="language-plaintext highlighter-rouge">foo/bar/__init__.py</code>, it’s impossible to access anything within the submodule other than <code class="language-plaintext highlighter-rouge">bar()</code>. However, with an empty init file, we could have called help on the submodule as:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="n">foo.bar</span> <span class="kn">import</span> <span class="n">bar</span>

<span class="o">&gt;&gt;&gt;</span> <span class="nf">help</span><span class="p">(</span><span class="n">bar</span><span class="p">)</span>
<span class="n">Help</span> <span class="n">on</span> <span class="n">module</span> <span class="n">foo</span><span class="p">.</span><span class="n">bar</span><span class="p">.</span><span class="n">bar</span> <span class="ow">in</span> <span class="n">foo</span><span class="p">.</span><span class="n">bar</span><span class="p">:</span>

<span class="n">NAME</span>
    <span class="n">foo</span><span class="p">.</span><span class="n">bar</span><span class="p">.</span><span class="n">bar</span> <span class="o">-</span> <span class="n">This</span> <span class="ow">is</span> <span class="n">a</span> <span class="n">really</span> <span class="kn">import</span> <span class="n">module</span><span class="err">!</span>

<span class="n">FUNCTIONS</span>
    <span class="nf">bar</span><span class="p">()</span>

<span class="n">FILE</span>
    <span class="n">foo</span><span class="o">/</span><span class="n">bar</span><span class="o">/</span><span class="n">bar</span><span class="p">.</span><span class="n">py</span>
</code></pre></div></div>

<h2 id="key-takeaways">Key Takeaways</h2>

<ol>
  <li>Don’t create additional modules within your source code if not required. A good rule of thumb is that splintering your code into submodules is only necessary if a certain <em>chunk</em> needs more than 1 file</li>
  <li>If you need to make a submodule, then use a blank <code class="language-plaintext highlighter-rouge">__init__.py</code> file if possible</li>
  <li>And if you have to do custom imports in your init file, and if you have to have a submodule called <code class="language-plaintext highlighter-rouge">bar</code>, then name the file <code class="language-plaintext highlighter-rouge">_bar.py</code> and the function something a little more creative such as <code class="language-plaintext highlighter-rouge">Bar</code></li>
</ol>

<p>And another top tip, make good use of the <a href="https://docs.python.org/3/tutorial/modules.html#importing-from-a-package"><code class="language-plaintext highlighter-rouge">__all__</code></a> variable.</p>
 ]]></content>
  </entry>

  <entry>
    <title type="text">Custom Obsidian Templater Daily Notes Template With Dynamic Linking</title>
    <link rel="alternate" type="text/html" href="https://janhendrikewers.uk/obsidian-templater-daily-notes-with-dynamic-linking.html" />
    <id>https://janhendrikewers.uk/obsidian-templater-daily-notes-with-dynamic-linking</id>
    <published>2022-08-01T00:00:00Z</published>
    <updated>2022-08-01T00:00:00Z</updated>
    <content type="html"><![CDATA[ <p>I’ve recently started using <a href="https://obsidian.md/">Obsidian</a>’s Daily Notes feature to keep track of what I’ve been doing. From the start I wanted to use <a href="https://silentvoid13.github.io/Templater">Templater</a> to dynamically create my daily notes such that <strong>each note to link to the previous one</strong>. And I’m not talking a simple <code class="language-plaintext highlighter-rouge">-1d</code> offset. I’m talking properly analysing the available files to then pick the most recent one akin to a <a href="https://www.geeksforgeeks.org/types-of-linked-list/">Singly Linked List</a></p>

<p>⚠️ First thing first, this isn’t a Templater tutorial so head to the <a href="https://silentvoid13.github.io/Templater/user-functions/overview.html">documentation</a> to learn how to do this yourself.</p>

<p>🧑‍💻 Go <a href="#complete-files">here</a> for the complete code</p>

<h2 id="implementation">Implementation</h2>

<p>Firstly, let’s scrape the file system through the <code class="language-plaintext highlighter-rouge">app.vault</code> api and exclude any notes without <code class="language-plaintext highlighter-rouge">Daily Notes</code> folder and let’s also exclude today’s (hard-coded for now) notes name:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nx">files</span> <span class="o">=</span> <span class="nx">app</span><span class="p">.</span><span class="nx">vault</span><span class="p">.</span><span class="nf">getMarkdownFiles</span><span class="p">()</span>
    <span class="p">.</span><span class="nf">filter</span><span class="p">(</span><span class="nx">file</span> <span class="o">=&gt;</span> <span class="nx">file</span><span class="p">.</span><span class="nx">path</span><span class="p">.</span><span class="nf">includes</span><span class="p">(</span><span class="dl">"</span><span class="s2">Daily Notes</span><span class="dl">"</span><span class="p">))</span>
    <span class="p">.</span><span class="nf">filter</span><span class="p">(</span><span class="nx">file</span> <span class="o">=&gt;</span> <span class="o">!</span><span class="nx">file</span><span class="p">.</span><span class="nx">path</span><span class="p">.</span><span class="nf">includes</span><span class="p">(</span><span class="dl">"</span><span class="s2">2022-08-01</span><span class="dl">"</span><span class="p">));</span>
</code></pre></div></div>

<p>Next we’ll evaluate how long ago the file was created based on it’s <code class="language-plaintext highlighter-rouge">basename</code></p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nx">now</span> <span class="o">=</span> <span class="nb">Date</span><span class="p">.</span><span class="nf">now</span><span class="p">().</span><span class="nf">valueOf</span><span class="p">();</span>

  <span class="nx">files</span> <span class="o">=</span> <span class="nx">files</span><span class="p">.</span><span class="nf">map</span><span class="p">(</span><span class="nx">file</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">file</span><span class="p">.</span><span class="nx">parsed_time</span> <span class="o">=</span> <span class="nb">Date</span><span class="p">.</span><span class="nf">parse</span><span class="p">(</span><span class="nx">file</span><span class="p">.</span><span class="nx">basename</span><span class="p">);</span>
    <span class="k">return</span> <span class="nx">file</span><span class="p">;</span>
  <span class="p">});</span>
</code></pre></div></div>

<p>Finally we’ll sort the array and select the most recent one</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nx">files</span> <span class="o">=</span> <span class="nx">files</span><span class="p">.</span><span class="nf">sort</span><span class="p">((</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">a</span><span class="p">.</span><span class="nx">parsed_time</span> <span class="o">&lt;</span> <span class="nx">b</span><span class="p">.</span><span class="nx">parsed_time</span><span class="p">);</span>
</code></pre></div></div>

<h2 id="template">Template</h2>

<p>Within a template we just call:</p>

<div class="language-md highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;</span><span class="err">%</span> <span class="na">tp.user.tag_previous_daily_note</span><span class="err">(</span><span class="na">tp.file.title</span><span class="err">,</span> <span class="err">"</span><span class="na">YOUR</span> <span class="na">DAILY</span> <span class="na">NOTE</span> <span class="na">PATH</span><span class="err">")</span> <span class="err">%</span><span class="nt">&gt;</span>
</code></pre></div></div>

<h2 id="complete-files">Complete Files</h2>

<p><code class="language-plaintext highlighter-rouge">tag_previous_daily_note.js</code></p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">function</span> <span class="nf">tag_previous_daily_note</span><span class="p">(</span><span class="nx">filename</span><span class="p">,</span> <span class="nx">path</span><span class="p">)</span> <span class="p">{</span>

  <span class="nx">files</span> <span class="o">=</span> <span class="nx">app</span><span class="p">.</span><span class="nx">vault</span><span class="p">.</span><span class="nf">getMarkdownFiles</span><span class="p">().</span><span class="nf">filter</span><span class="p">(</span><span class="nx">file</span> <span class="o">=&gt;</span> <span class="nx">file</span><span class="p">.</span><span class="nx">path</span><span class="p">.</span><span class="nf">includes</span><span class="p">(</span><span class="nx">path</span><span class="p">)).</span><span class="nf">filter</span><span class="p">(</span><span class="nx">file</span> <span class="o">=&gt;</span> <span class="o">!</span><span class="nx">file</span><span class="p">.</span><span class="nx">path</span><span class="p">.</span><span class="nf">includes</span><span class="p">(</span><span class="nx">filename</span><span class="p">));</span>

  <span class="nx">now</span> <span class="o">=</span> <span class="nb">Date</span><span class="p">.</span><span class="nf">now</span><span class="p">().</span><span class="nf">valueOf</span><span class="p">();</span>

  <span class="nx">files</span> <span class="o">=</span> <span class="nx">files</span><span class="p">.</span><span class="nf">map</span><span class="p">(</span><span class="nx">file</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">file</span><span class="p">.</span><span class="nx">parsed_time</span> <span class="o">=</span> <span class="nb">Date</span><span class="p">.</span><span class="nf">parse</span><span class="p">(</span><span class="nx">file</span><span class="p">.</span><span class="nx">basename</span><span class="p">);</span>
    <span class="k">return</span> <span class="nx">file</span><span class="p">;</span>
  <span class="p">});</span>

  <span class="nx">files</span> <span class="o">=</span> <span class="nx">files</span><span class="p">.</span><span class="nf">sort</span><span class="p">((</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">a</span><span class="p">.</span><span class="nx">parsed_time</span> <span class="o">&lt;</span> <span class="nx">b</span><span class="p">.</span><span class="nx">parsed_time</span><span class="p">);</span>

  <span class="k">return</span> <span class="nx">files</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">basename</span><span class="p">;</span>
<span class="p">}</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">tag_previous_daily_note</span><span class="p">;</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">daily_notes_template.md</code></p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>---
created: &lt;% tp.file.creation_date() %&gt;
tags: daily/&lt;% tp.date.now("YYYY/MMMM") %&gt;
---

# &lt;%tp.file.title%&gt;
---

**Previous** [[&lt;% tp.user.tag_previous_daily_note(tp.file.title,"Daily Notes")%&gt;]]

---

&lt;% tp.file.cursor(1) %&gt;
</code></pre></div></div>
 ]]></content>
  </entry>

  <entry>
    <title type="text">External Library Documentation URLS for PyCharm</title>
    <link rel="alternate" type="text/html" href="https://janhendrikewers.uk/useful_pycharm_urls.html" />
    <id>https://janhendrikewers.uk/useful_pycharm_urls</id>
    <published>2022-05-30T00:00:00Z</published>
    <updated>2022-05-30T00:00:00Z</updated>
    <content type="html"><![CDATA[ <p>Being able to hover over modules, classes, functions, etc. of a library and seeing the documentation is always great. This post acts as a resources for you to copy/paste the external documentation URL for your favourite libraries to enable this feature. For more information how to enable this, have a look <a href="#how">here</a></p>

<table>
    <tr><th>Library</th><th>Module</th><th>URL</th></tr>
  
    <tr>
    <td>Matplotlib </td>
    <td><code> matplotlib </code></td>
    <td><code> http://matplotlib.org/api/{module.basename}_api.html#{element.qname} </code></td>
    </tr>
  
    <tr>
    <td>Numpy </td>
    <td><code> numpy </code></td>
    <td><code> https://docs.scipy.org/doc/numpy/reference/generated/{element.qname}.html </code></td>
    </tr>
  
    <tr>
    <td>Pandas </td>
    <td><code> pandas </code></td>
    <td><code> https://pandas.pydata.org/pandas-docs/stable/generated/{element.qname}.html </code></td>
    </tr>
  
    <tr>
    <td>Scikit-Learn </td>
    <td><code>  sklearn </code></td>
    <td><code> https://scikit-learn.org/stable/modules/generated/{element.qname}.html#{element.qname} </code></td>
    </tr>
  
    <tr>
    <td>Scipy </td>
    <td><code> scipy </code></td>
    <td><code> https://docs.scipy.org/doc/scipy/reference/generated/{element.qname}.html </code></td>
    </tr>
  
    <tr>
    <td>Seaborn </td>
    <td><code> seaborn </code></td>
    <td><code> https://seaborn.pydata.org/generated/{module.name}.{element.name}.html#{module.name}.{element.name} </code></td>
    </tr>
  
</table>

<h2 id="how">How</h2>

<ol>
  <li>Go into your settings</li>
  <li>Navigate to <code class="language-plaintext highlighter-rouge">Tools | External Documentation</code></li>
  <li>Press <code class="language-plaintext highlighter-rouge">+</code></li>
  <li>Input the module name and url from above</li>
</ol>

<h2 id="contribute">Contribute</h2>

<p>If you have any useful URLs that you’d like added, please say so in the comments below!</p>
 ]]></content>
  </entry>

  <entry>
    <title type="text">Taking A Step In The General Direction Of Good Git OpSec</title>
    <link rel="alternate" type="text/html" href="https://janhendrikewers.uk/taking_a_step_in_the_general_direction_of_good_git_opsec.html" />
    <id>https://janhendrikewers.uk/taking_a_step_in_the_general_direction_of_good_git_opsec</id>
    <published>2022-05-09T00:00:00Z</published>
    <updated>2022-05-09T00:00:00Z</updated>
    <content type="html"><![CDATA[ <p>Every morning I tend to browse a few feeds: <a href="https://reddit.com/r/programming">r/programming</a>, <a href="https://reddit.com/r/linux">r/linux</a>, and <a href="https://github.com/trending">Github Trending</a>. That’s how I stumbled across <a href="https://github.com/GitGuardian/ggshield">ggshield</a> and as a result, also <a href="https://rtyley.github.io/bfg-repo-cleaner/">BFG Repo-Cleaner</a>.
I decided to sign up for GitGuardian to see if it’d find anything feeling quite confident. Quickly my hubris was shattered with <strong>31 open secrets</strong>!</p>

<p>Now, full disclosure, 13 of the 31 secrets were in a repository that a friend added me to for some help and another 15 were in private repositories. However, I would consider myself very careful with what I commit so this number was still quite shocking.</p>

<h2 id="the-remedy">The Remedy</h2>

<p>I had a quick look into every <em>incident</em> to see if it actually required attention. One stood out and I cannot believe I did this… I committed my SSH private key.</p>

<p>Some credit where it’s due though, the commit message when deleting it was “jan you’re a moron” and I must have generated a new private key when I realized. Nonetheless, why I didn’t look into cleaning the commit message is beyond me so let’s look into that now.</p>

<p>I previously mentioned the  BFG Repo-Cleaner so I quickly installed that with <code class="language-plaintext highlighter-rouge">yay -S bfg</code>. Looking at <code class="language-plaintext highlighter-rouge">bfg -h</code> I see</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">--delete-folders</span> &lt;glob&gt;  delete folders with the specified names <span class="o">(</span>eg <span class="s1">'.svn'</span>, <span class="s1">'*-tmp'</span> - matches on folder name, not path within repo<span class="o">)</span>
</code></pre></div></div>

<p>which is PERFECT.</p>

<p>Quickly <code class="language-plaintext highlighter-rouge">git clone --mirror REPO_URL</code> (the <code class="language-plaintext highlighter-rouge">--mirror</code> is very important) and cd into the project dir. I ran <code class="language-plaintext highlighter-rouge">bfg --delete-folders "ssh" ./</code> followed by <code class="language-plaintext highlighter-rouge">git reflog expire --expire=now --all &amp;&amp; git gc --prune=now --aggressive</code> (this big command is printed at the end of the bfg logs to ensure the updates are propagated). One final command, <code class="language-plaintext highlighter-rouge">git push</code>, and now <em>hey presto</em> it’s gone!</p>

<h2 id="post-mortem">Post Mortem</h2>

<p>I learnt a few things today:</p>

<ol>
  <li>No matter how careful I think I am being, I’m only human and will probably <code class="language-plaintext highlighter-rouge">git add</code> something unsavoury without thinking about it.</li>
  <li>Monitor, monitor, and monitor. You can’t catch something if you’re not looking for it.</li>
</ol>

<p>Yes the private key had been changed but it might still be listed as an authorized key on another server. You just don’t know and as such, being proactive about it and cleaning your git history is probably a good idea.</p>
 ]]></content>
  </entry>

  <entry>
    <title type="text">Pydantic vs Protobuf vs Namedtuples vs Dataclasses</title>
    <link rel="alternate" type="text/html" href="https://janhendrikewers.uk/pydantic_vs_protobuf_vs_namedtuple_vs_dataclasses.html" />
    <id>https://janhendrikewers.uk/pydantic_vs_protobuf_vs_namedtuple_vs_dataclasses</id>
    <published>2022-03-22T00:00:00Z</published>
    <updated>2022-03-22T00:00:00Z</updated>
    <content type="html"><![CDATA[ <p>Before my introduction to <a href="https://fastapi.tiangolo.com/">FastAPI</a> I was manually crafting classes to hold data. This was completely fine, but then <a href="https://pydantic-docs.helpmanual.io/">pydantic</a> changed the way I thought about this. Who wants to write a custom <code class="language-plaintext highlighter-rouge">__init__</code> class for every data type, with type checking? However, over-time I’ve learnt some of it’s limitations and other libraries such as <a href="https://github.com/protocolbuffers/protobuf">protobuf</a> or <a href="https://docs.python.org/3/library/collections.html#collections.namedtuple">namedtuple</a> kept cropping up. My hunger to over-complicate everything finally made me try them all out and this post is the result of that inability to KISS<sup id="fnref:kiss" role="doc-noteref"><a href="#fn:kiss" class="footnote" rel="footnote">1</a></sup>.</p>

<h3 class="no_toc" id="table-of-contents">Table of Contents</h3>

<ul id="markdown-toc">
  <li><a href="#experimental-setup" id="markdown-toc-experimental-setup">Experimental Setup</a></li>
  <li><a href="#creation" id="markdown-toc-creation">Creation</a></li>
  <li><a href="#type-conversions" id="markdown-toc-type-conversions">Type Conversions</a></li>
  <li><a href="#instantiation-performance" id="markdown-toc-instantiation-performance">Instantiation Performance</a></li>
  <li><a href="#deserialization" id="markdown-toc-deserialization">(De)serialization</a>    <ul>
      <li><a href="#json" id="markdown-toc-json">JSON</a></li>
      <li><a href="#smallest-possible" id="markdown-toc-smallest-possible">Smallest Possible</a></li>
    </ul>
  </li>
  <li><a href="#conclusion" id="markdown-toc-conclusion">Conclusion</a></li>
  <li><a href="#appendix" id="markdown-toc-appendix">Appendix</a></li>
</ul>

<h2 id="experimental-setup">Experimental Setup</h2>

<p>As I’m doing a lot of simulations in the near future, I decided to use two data types</p>

<ol>
  <li>
    <p>Coord</p>

    <ul>
      <li>Holds <code class="language-plaintext highlighter-rouge">x</code>, <code class="language-plaintext highlighter-rouge">y</code>, <code class="language-plaintext highlighter-rouge">z</code>, and <code class="language-plaintext highlighter-rouge">heading</code></li>
      <li>All of type <code class="language-plaintext highlighter-rouge">float</code></li>
    </ul>
  </li>
  <li>
    <p>Coords</p>

    <ul>
      <li>Holds an unbounded list of <code class="language-plaintext highlighter-rouge">Coord</code>s under coords.</li>
    </ul>
  </li>
</ol>

<p>These were then instantiated with the <em>same</em> random data using</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">xs</span><span class="p">,</span> <span class="n">ys</span><span class="p">,</span> <span class="n">zs</span><span class="p">,</span> <span class="n">heading</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="nf">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">15</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
</code></pre></div></div>

<p>Note the <code class="language-plaintext highlighter-rouge">dtype=int</code>. This was done to test if the class do any type conversion (<em>spoiler:</em> some do).</p>

<p>The variables in the following code examples have prefixes to show what library they are related to. <code class="language-plaintext highlighter-rouge">NT</code> is <code class="language-plaintext highlighter-rouge">namedtuple</code>, <code class="language-plaintext highlighter-rouge">DC</code> is <code class="language-plaintext highlighter-rouge">dataclasses</code>, <code class="language-plaintext highlighter-rouge">PD</code> is <code class="language-plaintext highlighter-rouge">pydantic</code>, and <code class="language-plaintext highlighter-rouge">PB</code> is <code class="language-plaintext highlighter-rouge">protobuf</code>. Easy.</p>

<h2 id="creation">Creation</h2>

<p>After creating the data models, as seen in the <a href="#appendix">appendix</a>, the classes were intialized. The method for <code class="language-plaintext highlighter-rouge">dataclasses</code>, <code class="language-plaintext highlighter-rouge">namedtuples</code> and <code class="language-plaintext highlighter-rouge">pydantic</code> were identical.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">generate</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">f</span><span class="p">,</span><span class="n">g</span><span class="p">,</span><span class="n">h</span><span class="p">,</span><span class="n">i</span><span class="p">):</span>
  <span class="k">return</span> <span class="p">[</span><span class="nf">t</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">fi</span><span class="p">.</span><span class="nf">item</span><span class="p">(),</span><span class="n">y</span><span class="o">=</span><span class="n">gi</span><span class="p">.</span><span class="nf">item</span><span class="p">(),</span><span class="n">z</span><span class="o">=</span><span class="n">hi</span><span class="p">.</span><span class="nf">item</span><span class="p">(),</span><span class="n">heading</span><span class="o">=</span><span class="n">ii</span><span class="p">.</span><span class="nf">item</span><span class="p">())</span> <span class="k">for</span> <span class="n">fi</span><span class="p">,</span> <span class="n">gi</span><span class="p">,</span> <span class="n">hi</span><span class="p">,</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nf">zip</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">i</span><span class="p">)]</span>

<span class="n">dccoords</span> <span class="o">=</span> <span class="nc">DCCoords</span><span class="p">(</span><span class="n">coords</span><span class="o">=</span><span class="nf">generate</span><span class="p">(</span><span class="n">DCCoord</span><span class="p">,</span> <span class="n">xs</span><span class="p">,</span> <span class="n">ys</span><span class="p">,</span> <span class="n">zs</span><span class="p">,</span> <span class="n">headings</span><span class="p">))</span>
<span class="n">ntcoords</span> <span class="o">=</span> <span class="nc">NTCoords</span><span class="p">(</span><span class="n">coords</span><span class="o">=</span><span class="nf">generate</span><span class="p">(</span><span class="n">NTCoord</span><span class="p">,</span> <span class="n">xs</span><span class="p">,</span> <span class="n">ys</span><span class="p">,</span> <span class="n">zs</span><span class="p">,</span> <span class="n">headings</span><span class="p">))</span>
<span class="n">pdcoords</span> <span class="o">=</span> <span class="nc">PDCoords</span><span class="p">(</span><span class="n">coords</span><span class="o">=</span><span class="nf">generate</span><span class="p">(</span><span class="n">PDCoord</span><span class="p">,</span> <span class="n">xs</span><span class="p">,</span> <span class="n">ys</span><span class="p">,</span> <span class="n">zs</span><span class="p">,</span> <span class="n">headings</span><span class="p">))</span>
</code></pre></div></div>

<p>Protobuf was much different though. As can be seen on line 3 below, the coord is added to the list of coords, and then filled with values. This results in quite a bit more boiler plate code but if one knows about it, it’s surprisingly readable.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="code"><pre><span class="n">pbcoords</span> <span class="o">=</span> <span class="nc">PBCoords</span><span class="p">()</span>
<span class="k">for</span> <span class="n">xi</span><span class="p">,</span><span class="n">yi</span><span class="p">,</span><span class="n">zi</span><span class="p">,</span><span class="n">headingi</span> <span class="ow">in</span> <span class="nf">zip</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span><span class="n">ys</span><span class="p">,</span><span class="n">zs</span><span class="p">,</span><span class="n">headings</span><span class="p">):</span>
<span class="n">pbcoord</span> <span class="o">=</span> <span class="n">pbcoords</span><span class="p">.</span><span class="n">coords</span><span class="p">.</span><span class="nf">add</span><span class="p">()</span>
<span class="n">pbcoord</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">xi</span>
<span class="n">pbcoord</span><span class="p">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">yi</span>
<span class="n">pbcoord</span><span class="p">.</span><span class="n">z</span> <span class="o">=</span> <span class="n">zi</span>
<span class="n">pbcoord</span><span class="p">.</span><span class="n">heading</span> <span class="o">=</span> <span class="n">heading</span>
</pre></td></tr></tbody></table></code></pre></figure>

<h2 id="type-conversions">Type Conversions</h2>

<p>All 4 data models were filled with int on purpose. <code class="language-plaintext highlighter-rouge">dataclasses</code>, <code class="language-plaintext highlighter-rouge">pydantic</code>, and <code class="language-plaintext highlighter-rouge">protobuf</code> have capabilities to define a data type for each field so those are the ones expected to convert the data <em>if possible</em>.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">isinstance</span><span class="p">(</span><span class="n">dccoords</span><span class="p">.</span><span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">x</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span>  <span class="c1"># False
</span><span class="nf">isinstance</span><span class="p">(</span><span class="n">ntcoords</span><span class="p">.</span><span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">x</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span>  <span class="c1"># False
</span><span class="nf">isinstance</span><span class="p">(</span><span class="n">pdcoords</span><span class="p">.</span><span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">x</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span>  <span class="c1"># True
</span><span class="nf">isinstance</span><span class="p">(</span><span class="n">pbcoords</span><span class="p">.</span><span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">x</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span>  <span class="c1"># True
</span></code></pre></div></div>

<p>That’s weird… <code class="language-plaintext highlighter-rouge">dataclasses</code> don’t convert the field? Apparently this is expected behaviour and the suggested workaround is using a static type-checker like <a href="https://mypy-lang.org/"><code class="language-plaintext highlighter-rouge">mypy</code></a>, <a href="https://pydantic-docs.helpmanual.io/usage/validation_decorator/"><code class="language-plaintext highlighter-rouge">pydantic.validate_arguments</code></a>, or in the <a href="https://docs.python.org/3/library/dataclasses.html#post-init-processing"><code class="language-plaintext highlighter-rouge">dataclass.dataclasses.__post_init__</code></a> method.</p>

<p><code class="language-plaintext highlighter-rouge">pydantic</code> and <code class="language-plaintext highlighter-rouge">protobuf</code> both convert the types which is nice. However, will this add much computational overhead?</p>

<h2 id="instantiation-performance">Instantiation Performance</h2>

<p>One of the largest downsides of using a data class is the additional performance overhead. In my simulations, I run hundreds of thousands of trials with multiple thousand steps so any increase in computational time is noticed.</p>

<p class="centre"><img src="/static/img/2022-03-22-pydantic_vs_protobuf_vs_namedtuple_vs_dataclasses/speed.png" alt="png" class="img-responsive" />
<em>Mean time to instantiate a single <code class="language-plaintext highlighter-rouge">Coord</code> class in the respective libraries</em></p>

<p>This is where we can really see the overhead of converting the types from <code class="language-plaintext highlighter-rouge">int</code> to <code class="language-plaintext highlighter-rouge">float</code> in <code class="language-plaintext highlighter-rouge">pydantic</code>. However, <code class="language-plaintext highlighter-rouge">protobuf</code> does not have nearly the same problems<sup id="fnref:fw" role="doc-noteref"><a href="#fn:fw" class="footnote" rel="footnote">2</a></sup>.</p>

<p>I’m honestly quite shocked at how well <code class="language-plaintext highlighter-rouge">protobuf</code> did. It’s mean time was <code class="language-plaintext highlighter-rouge">685ns</code> whilst <code class="language-plaintext highlighter-rouge">namedtuple</code> achieved <code class="language-plaintext highlighter-rouge">608ns</code> and <code class="language-plaintext highlighter-rouge">dataclasses</code> did <code class="language-plaintext highlighter-rouge">643ns</code>.</p>

<h2 id="deserialization">(De)serialization</h2>

<h3 id="json">JSON</h3>

<p>Another important aspect is storing my millions of data points. The “classic” method is via CSV or JSON. However, this struggles with multiple <code class="language-plaintext highlighter-rouge">Coords</code> so we’ll give JSON a shot. Yes it’s not meant for storing large series data but it’s easy and available and probably what most people will turn to. <a href="https://docs.python.org/3/library/pickle.html">Pickleing</a> is another option but this does not create human readable output, nor does it store very well<sup id="fnref:pickle-vs-json" role="doc-noteref"><a href="#fn:pickle-vs-json" class="footnote" rel="footnote">3</a></sup>.</p>

<p><code class="language-plaintext highlighter-rouge">dataclasses</code> were a weird one, because it required a custom JSON encoder. However, 5 lines of additional code isn’t too bad in my opinion.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">json</span>
<span class="k">class</span> <span class="nc">EnhancedJSONEncoder</span><span class="p">(</span><span class="n">json</span><span class="p">.</span><span class="n">JSONEncoder</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">default</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">o</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">dataclasses</span><span class="p">.</span><span class="nf">is_dataclass</span><span class="p">(</span><span class="n">o</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">dataclasses</span><span class="p">.</span><span class="nf">asdict</span><span class="p">(</span><span class="n">o</span><span class="p">)</span>
            <span class="k">return</span> <span class="nf">super</span><span class="p">().</span><span class="nf">default</span><span class="p">(</span><span class="n">o</span><span class="p">)</span>

<span class="n">dccoords_json</span> <span class="o">=</span> <span class="n">json</span><span class="p">.</span><span class="nf">dumps</span><span class="p">(</span><span class="n">dccoords</span><span class="p">,</span> <span class="n">separators</span><span class="o">=</span><span class="p">(</span><span class="s">','</span><span class="p">,</span> <span class="s">':'</span><span class="p">),</span>  <span class="n">cls</span><span class="o">=</span><span class="n">EnhancedJSONEncoder</span><span class="p">)</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">namedtuple</code> was actually quite easy, using the inbuilt <code class="language-plaintext highlighter-rouge">_asdict()</code> method resulted in</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ntcoords_json</span> <span class="o">=</span> <span class="n">json</span><span class="p">.</span><span class="nf">dumps</span><span class="p">(</span><span class="n">ntcoords</span><span class="p">.</span><span class="nf">_asdict</span><span class="p">(),</span> <span class="n">separators</span><span class="o">=</span><span class="p">(</span><span class="s">','</span><span class="p">,</span> <span class="s">':'</span><span class="p">))</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">pydantic</code> has a built in <code class="language-plaintext highlighter-rouge">json()</code> method so this was as easy as <code class="language-plaintext highlighter-rouge">pdcoords_json = dcoords.json()</code>.</p>

<p><code class="language-plaintext highlighter-rouge">protobuf</code>, being different as per, required the import of <code class="language-plaintext highlighter-rouge">MessageToJson</code>:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">google.protobuf.json_format</span> <span class="kn">import</span> <span class="n">MessageToJson</span>
<span class="n">pbcoords_json</span> <span class="o">=</span> <span class="nc">MessageToJson</span><span class="p">(</span><span class="n">pbcoords</span><span class="p">,</span><span class="n">indent</span><span class="o">=</span><span class="mi">0</span><span class="p">).</span><span class="nf">replace</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span><span class="s">""</span><span class="p">)</span>
</code></pre></div></div>

<p>All serializations were more or less identical <em>except</em> for <code class="language-plaintext highlighter-rouge">namedtuple</code>. For whatever reason the list of <code class="language-plaintext highlighter-rouge">NTCoord</code>s was serialized into a 2D array. Hopefully this won’t cause any issues with the de-serialization (foreshadowing much?)</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"coords"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">[</span><span class="mi">13</span><span class="p">,</span><span class="w"> </span><span class="mi">37</span><span class="p">,</span><span class="w"> </span><span class="mi">45</span><span class="p">,</span><span class="w"> </span><span class="mi">90</span><span class="p">],</span><span class="w">
    </span><span class="p">[</span><span class="mi">93</span><span class="p">,</span><span class="w"> </span><span class="mi">44</span><span class="p">,</span><span class="w"> </span><span class="mi">55</span><span class="p">,</span><span class="w"> </span><span class="mi">54</span><span class="p">],</span><span class="w">
    </span><span class="p">[</span><span class="mi">41</span><span class="p">,</span><span class="w"> </span><span class="mi">50</span><span class="p">,</span><span class="w"> </span><span class="mi">74</span><span class="p">,</span><span class="w"> </span><span class="mi">34</span><span class="p">],</span><span class="w">
    </span><span class="p">[</span><span class="mi">85</span><span class="p">,</span><span class="w"> </span><span class="mi">59</span><span class="p">,</span><span class="w"> </span><span class="mi">57</span><span class="p">,</span><span class="w"> </span><span class="mi">85</span><span class="p">],</span><span class="w">
    </span><span class="p">[</span><span class="mi">79</span><span class="p">,</span><span class="w"> </span><span class="mi">85</span><span class="p">,</span><span class="w"> </span><span class="mi">92</span><span class="p">,</span><span class="w"> </span><span class="mi">58</span><span class="p">],</span><span class="w">
    </span><span class="p">[</span><span class="mi">47</span><span class="p">,</span><span class="w"> </span><span class="mi">26</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">30</span><span class="p">],</span><span class="w">
    </span><span class="p">[</span><span class="mi">89</span><span class="p">,</span><span class="w"> </span><span class="mi">24</span><span class="p">,</span><span class="w"> </span><span class="mi">81</span><span class="p">,</span><span class="w"> </span><span class="mi">65</span><span class="p">],</span><span class="w">
    </span><span class="p">[</span><span class="mi">23</span><span class="p">,</span><span class="w"> </span><span class="mi">71</span><span class="p">,</span><span class="w"> </span><span class="mi">30</span><span class="p">,</span><span class="w"> </span><span class="mi">54</span><span class="p">],</span><span class="w">
    </span><span class="p">[</span><span class="mi">78</span><span class="p">,</span><span class="w"> </span><span class="mi">79</span><span class="p">,</span><span class="w"> </span><span class="mi">74</span><span class="p">,</span><span class="w"> </span><span class="mi">97</span><span class="p">],</span><span class="w">
    </span><span class="p">[</span><span class="mi">28</span><span class="p">,</span><span class="w"> </span><span class="mi">30</span><span class="p">,</span><span class="w"> </span><span class="mi">61</span><span class="p">,</span><span class="w"> </span><span class="mi">56</span><span class="p">],</span><span class="w">
    </span><span class="p">[</span><span class="mi">51</span><span class="p">,</span><span class="w"> </span><span class="mi">72</span><span class="p">,</span><span class="w"> </span><span class="mi">92</span><span class="p">,</span><span class="w"> </span><span class="mi">7</span><span class="p">],</span><span class="w">
    </span><span class="p">[</span><span class="mi">74</span><span class="p">,</span><span class="w"> </span><span class="mi">49</span><span class="p">,</span><span class="w"> </span><span class="mi">72</span><span class="p">,</span><span class="w"> </span><span class="mi">64</span><span class="p">],</span><span class="w">
    </span><span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">14</span><span class="p">,</span><span class="w"> </span><span class="mi">16</span><span class="p">,</span><span class="w"> </span><span class="mi">42</span><span class="p">],</span><span class="w">
    </span><span class="p">[</span><span class="mi">86</span><span class="p">,</span><span class="w"> </span><span class="mi">93</span><span class="p">,</span><span class="w"> </span><span class="mi">70</span><span class="p">,</span><span class="w"> </span><span class="mi">77</span><span class="p">],</span><span class="w">
    </span><span class="p">[</span><span class="mi">64</span><span class="p">,</span><span class="w"> </span><span class="mi">55</span><span class="p">,</span><span class="w"> </span><span class="mi">15</span><span class="p">,</span><span class="w"> </span><span class="mi">35</span><span class="p">]</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>Deserializing from the JSON string showed pretty much exactly what I expected.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">DCCoords</span><span class="p">(</span><span class="o">**</span><span class="n">json</span><span class="p">.</span><span class="nf">loads</span><span class="p">(</span><span class="n">dccoords_json</span><span class="p">))</span> <span class="o">==</span> <span class="n">dccoords</span> <span class="c1"># False
</span><span class="nc">NTCoords</span><span class="p">(</span><span class="o">**</span><span class="n">json</span><span class="p">.</span><span class="nf">loads</span><span class="p">(</span><span class="n">ntcoords_json</span><span class="p">))</span> <span class="o">==</span> <span class="n">ntcoords</span> <span class="c1"># False
</span><span class="n">PDCoords</span><span class="p">.</span><span class="nf">parse_raw</span><span class="p">(</span><span class="n">pdcoords_json</span><span class="p">)</span> <span class="o">==</span> <span class="n">pdcoords</span>     <span class="c1"># True
</span>
<span class="kn">from</span> <span class="n">google.protobuf.json_format</span> <span class="kn">import</span> <span class="n">Parse</span> <span class="k">as</span> <span class="n">JsonToMessage</span>
<span class="nc">JsonToMessage</span><span class="p">(</span><span class="n">pbcoords_json</span><span class="p">,</span> <span class="nc">PBCoords</span><span class="p">())</span> <span class="o">==</span> <span class="n">pbcoords</span> <span class="c1"># True
</span></code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">namedtuple</code> lost the data structure when it converted to JSON and <code class="language-plaintext highlighter-rouge">dataclasses</code> does not properly convert the types at instantiation. <code class="language-plaintext highlighter-rouge">pydantic</code> and <code class="language-plaintext highlighter-rouge">protobuf</code> both check what types every field was using and converts the data (correctly) back into that type.</p>

<h3 id="smallest-possible">Smallest Possible</h3>

<p>Whilst JSON is great for human-readable, easy-to-transfer data, it is not compact. For the next comparison where possible, the smallest representation was used. Deserialization was not considered as right now we’re only concerned with storing large sets of data. Using it is someone else’s job (usually me, in a few weeks time).</p>

<p><code class="language-plaintext highlighter-rouge">protobuf</code> is the only non-JSON encoding. The inbuilt <code class="language-plaintext highlighter-rouge">SerializeToString</code> is very powerful and one of the core features of the library. Since the data class is compiled with a tool, and not just into python, it gives developers a huge advantage by easily creating highly optimized <strong>cross-platform</strong> data.</p>

<p class="centre"><img src="/static/img/2022-03-22-pydantic_vs_protobuf_vs_namedtuple_vs_dataclasses/size.png" alt="png" class="img-responsive" />
<em>Size of the compressed data for a <code class="language-plaintext highlighter-rouge">Coords</code> class from the respective libraries</em></p>

<p>Evidently <code class="language-plaintext highlighter-rouge">pydantic</code> is the “worst”. However, is it? <code class="language-plaintext highlighter-rouge">dataclasses</code> never converted the data to a float and as such, the raw JSON string will be missing the <code class="language-plaintext highlighter-rouge">.0</code>. With <code class="language-plaintext highlighter-rouge">2*4*15=120</code> bytes of missing data, the two are actually equal (<code class="language-plaintext highlighter-rouge">549+120 == 669</code>).</p>

<p>Next, why is <code class="language-plaintext highlighter-rouge">namedtuple</code> better than <code class="language-plaintext highlighter-rouge">protobuf</code>? Isn’t protobuf “oh so highly optimized”? Well yes, but if we recall from the JSON serialization results, <code class="language-plaintext highlighter-rouge">namedtuple</code> just bungs the data into a 2D array and cannot deserialize it properly. A 2D array will always be smaller than a data structure that tries to save as much data about the object as possible. The JSON output for <code class="language-plaintext highlighter-rouge">dataclasses</code>, <code class="language-plaintext highlighter-rouge">pydantic</code>, and <code class="language-plaintext highlighter-rouge">protobuf</code> were close to identical, so a <code class="language-plaintext highlighter-rouge">2x</code> improvement is very impressive.</p>

<h2 id="conclusion">Conclusion</h2>

<p>To your dismay, there is no easy conclusion. I have fallen in love with the idea of using <code class="language-plaintext highlighter-rouge">protobuf</code>s, but the overhead of compilation and the weird method of creating the classes is quite off-putting. The speed and serialization benefits over the other 3 cannot be played down though.</p>

<p><code class="language-plaintext highlighter-rouge">pydantic</code> performed shockingly bad, but the strict type checking and ease of use will have me coming for less performant instances.</p>

<p>The benefits of <code class="language-plaintext highlighter-rouge">dataclasses</code> and <code class="language-plaintext highlighter-rouge">namedtuples</code> are as they’ve always been: both are shipped with <a href="https://github.com/python/cpython/blob/3.10/Lib/dataclasses.py"><code class="language-plaintext highlighter-rouge">cpython</code></a> and are sufficient. <code class="language-plaintext highlighter-rouge">namedtuples</code> can be created in one line and allow easy to read code, whilst <code class="language-plaintext highlighter-rouge">dataclasses</code> are more akin to <code class="language-plaintext highlighter-rouge">pydantic</code> but require more setup.</p>

<p>I hope this investigation into the 4 main data class libraries in Python have helped you. If you have any libraries you think I should have included, please let me know in the <a href="#comments">comments</a>!</p>

<h2 id="appendix">Appendix</h2>

<script src="https://gist.github.com/iwishiwasaneagle/fd304f7d951aa6ebeb13b5715f7a6410.js"></script>

<hr />

<div class="footnotes" role="doc-endnotes">
  <ol>
    <li id="fn:kiss" role="doc-endnote">
      <p>Keep It Simple, Stupid. <a href="#fnref:kiss" class="reversefootnote" role="doc-backlink">&#8617;</a></p>
    </li>
    <li id="fn:fw" role="doc-endnote">
      <p>This might call for more investigation in the future if this article does well. <a href="#fnref:fw" class="reversefootnote" role="doc-backlink">&#8617;</a></p>
    </li>
    <li id="fn:pickle-vs-json" role="doc-endnote">
      <p>For a more in-depth discussion between pickle vs json, have a look <a href="https://docs.python.org/3/library/pickle.html#comparison-with-json">here</a>. <a href="#fnref:pickle-vs-json" class="reversefootnote" role="doc-backlink">&#8617;</a></p>
    </li>
  </ol>
</div>
 ]]></content>
  </entry>


</feed>
